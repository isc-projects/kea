<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN"
               "http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd"
	       [<!ENTITY mdash "&#8212;">]>
<!--
 - Copyright (C) 2013  Internet Systems Consortium, Inc. ("ISC")
 -
 - Permission to use, copy, modify, and/or distribute this software for any
 - purpose with or without fee is hereby granted, provided that the above
 - copyright notice and this permission notice appear in all copies.
 -
 - THE SOFTWARE IS PROVIDED "AS IS" AND ISC DISCLAIMS ALL WARRANTIES WITH
 - REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
 - AND FITNESS.  IN NO EVENT SHALL ISC BE LIABLE FOR ANY SPECIAL, DIRECT,
 - INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
 - LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE
 - OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
 - PERFORMANCE OF THIS SOFTWARE.
-->

<refentry>

  <refentryinfo>
    <date>September 25, 2013</date>
  </refentryinfo>

  <refmeta>
    <refentrytitle>perfdhcp</refentrytitle>
    <manvolnum>1</manvolnum>
    <refmiscinfo>BIND10</refmiscinfo>
  </refmeta>

  <refnamediv>
    <refname>perfdhcp</refname>
    <refpurpose>DHCP benchmarking tool</refpurpose>
  </refnamediv>

  <docinfo>
    <copyright>
      <year>2013</year>
      <holder>Internet Systems Consortium, Inc. ("ISC")</holder>
    </copyright>
  </docinfo>

<!-- TODO: some examples show -fflag and -f flag - do both work? -->
<!-- TODO: rewrite descriptions so say string or number etc -->

  <refsynopsisdiv>
    <cmdsynopsis>
      <command>perfdhcp</command>
      <arg><option>-e</option></arg>
    </cmdsynopsis>
  </refsynopsisdiv>

  <refsect1>
    <title>DESCRIPTION</title>
    <para><command>perfdhcp</command> is a DHCP benchmarking tool.
      It provides a way of measuring the performance of DHCP servers
      by generating large amounts of traffic.
      It is able to test both IPv4 and IPv6 servers.
      It can time the initial two-packet exchange (DO and SA) and
      the four-packet exchange (DORA and SARR).
    </para>

  </refsect1>

  <refsect1>
    <title>OPTIONS</title>

    <para>The arguments are as follows:</para>

    <variablelist>

      <varlistentry>
        <term>
          <option>-1</option>
        </term>
        <listitem>
          <para>Take the server-ID option from the first received
          message.
<!-- TODO: The default is .... (not to use the server-ID option
from the first received message. -->
          </para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-4</option>
        </term>
        <listitem>
          <para>DHCPv4 operation. This is the default. This is incompatible
          with the -6 option.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-6</option>
        </term>
        <listitem>
          <para>DHCPv6 operation. This is incompatible with the -4
          option.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-a</option>
          <replaceable class="parameter">aggressivity</replaceable>
        </term>
        <listitem>
          <para>When the target sending rate is not yet reached,
          control how many exchanges are initiated before the next
          pause. This is set to a positive integer. The default is 1.</para>
        </listitem>
      </varlistentry>

      <!-- TODO: number? -->
      <varlistentry>
        <term>
          <option>-b</option>
          <replaceable class="parameter">basetype=value</replaceable>
        </term>
        <listitem>
          <para>The base MAC or DUID used to simulate different clients.
          The <replaceable class="parameter">basetype</replaceable>
          may be mac or duid. (The keyword "ether" may alternatively
          used for MAC.)
          The -b option can be specified multiple times.
          The MAC address must consist of six octets separated by
          single (:) or double (::) colons, for example:
          mac=00:0c:01:02:03:04.
	  The DUID value is a hexadecimal string;
          it must be at least six octets long and must not be
	  longer than 64 bytes and the length must be less than
	  128 hexadecimal digits, for example:
          duid=0101010101010101010110111F14.</para>
<!-- TODO: code mentions duid=0F1234 but isn't that too short? -->
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-d</option>
          <replaceable class="parameter">drop-time</replaceable>
        </term>
        <listitem>
          <para>Specify the time after which a request is treated
          as having been lost. The value is given in seconds and
          may contain a fractional component. The default is 1
          second.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-E</option>
          <replaceable class="parameter">time-offset</replaceable>
        </term>
        <listitem>
          <para>Offset of the (DHCPv4) secs field / (DHCPv6)
          elapsed-time option in the (second/request) template.
          The value must be 0 or a positive integer.
          The value 0 disables it. This is incompatible
          with the -i option.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-e</option>
          <replaceable class="parameter">lease-type</replaceable>
        </term>
        <listitem>
          <para>The type of lease being requested from the server.
          It may be one of the following: address-only, prefix-only
          or address-and-prefix. The address-only indicates that
          the regular address (v4 or v6) will be requested. The
          prefix-only indicates that the IPv6 prefix will be
          requested. The address-and-prefix indicates that both
          IPv6 address and prefix will be requested. The '-e
          prefix-only' and '-e address-and-prefix' must not be used
          with -4. (The -6 option must be used if lease type other
          than '-e address-only'.)</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-h</option>
        </term>
        <listitem>
          <para>Print help.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-i</option>
        </term>
        <listitem>
          <para>Do only the initial part of an exchange: DO or SA.
          If DHCPv4 mode (-4) is does DISCOVER-OFFER only.
          If DHCPv6 mode (-6) is does SOLICIT-ADVERTISE only.</para>
<!-- TODO:  The default is to use 4-way DORA for
DHCPv4 and SARR for DHCPv6. -->
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-I</option>
          <replaceable class="parameter">ip-offset</replaceable>
        </term>
        <listitem>
          <para>Offset of the (DHCPv4) IP address in the
          requested-IP option / (DHCPv6) IA_NA option in the
          (second/request) template. This value is a positive integer.
          This is incompatible with the -i option.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-l</option>
          <replaceable class="parameter">local-addr|interface</replaceable>
        </term>
        <listitem>
          <para>For DHCPv4 operation, specify the local
          hostname/address to use when communicating with the
          server. By default, the interface address through which
          traffic would normally be routed to the server is used.
          For DHCPv6 operation, specify the name of the network
          interface via which exchanges are initiated.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-L</option>
          <replaceable class="parameter">local-port</replaceable>
        </term>
        <listitem>
          <para>Specify the local port to use.
          The value must be 0 or a positive integer up to 65535.
<!-- NOTE: within uint16_t -->
          The value 0 means to use the default.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-O</option>
          <replaceable class="parameter">random-offset</replaceable>
        </term>
        <listitem>
          <para>Offset of the last octet to randomize in the
          template. The value must be greater than 3.
          The -T switch must be used with -O.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-P</option>
          <replaceable class="parameter">preload</replaceable>
        </term>
        <listitem>
          <para>Initiate first
          <replaceable class="parameter">preload</replaceable>
          exchanges back to back at startup.
          The value must be 0 or a positive integer.</para>
<!-- TODO: The default is 0 - what does that mean? -->
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-r</option>
          <replaceable class="parameter">rate</replaceable>
        </term>
        <listitem>
          <para>Initiate
          <replaceable class="parameter">rate</replaceable>
          DORA/SARR (or if -i is given, DO/SA)
          exchanges per second. The value is a positive integer.
	  A periodic report is generated showing the number of
	  exchanges which were not completed, as well as the average
	  response latency. The program continues until interrupted,
	  at which point a final report is generated.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-R</option>
          <replaceable class="parameter">range</replaceable>
        </term>
        <listitem>
          <para>Specify how many different clients are used. With 1
          (the default), all requests seem to come from the same
          client.
          The value must be 0 or a positive integer.</para>
<!-- TODO: Why does help say default is 1? what does 0 mean? -->
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-s</option>
          <replaceable class="parameter">seed</replaceable>
        </term>
        <listitem>
          <para>Specify the seed for randomization, making it
          repeatable.
          The value must be 0 or a positive integer.
          The value 0 means a seed is not used; this is the default.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-S</option>
          <replaceable class="parameter">srvid-offset</replaceable>
        </term>
        <listitem>
          <para>Offset of the server-ID option in the
          (second/request) template. The value is a positive integer.
          This is incompatible with the -i option.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-T</option>
          <replaceable class="parameter">template-file</replaceable>
        </term>
        <listitem>
          <para>The name of a file containing the template to use
          as a stream of hexadecimal digits.</para>
<!-- TODO: this switch can be used a second time except with -i -->
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-v</option>
        </term>
        <listitem>
          <para>Report the version number of this program.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-w</option>
          <replaceable class="parameter">wrapped</replaceable>
        </term>
        <listitem>
          <para>Command to call with start/stop at the
          beginning/end of the program.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-x</option>
          <replaceable class="parameter">diagnostic-selector</replaceable>
        </term>
        <listitem>
          <para>Include extended diagnostics in the output.
          <replaceable class="parameter">diagnostic-selector</replaceable>
<!-- TODO: fix formatting -->
	  is a string of single-keywords specifying the operations
	  for which verbose output is desired. The selector keyletters
	  are: 'a' print the decoded command line arguments,
	  'e' print the exit reason, 'i' print rate processing
	  details, 's' print first server-id, 't' when finished,
	  print timers of all successful exchanges, 'T' when
	  finished, print templates.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-X</option>
          <replaceable class="parameter">xid-offset</replaceable>
        </term>
        <listitem>
          <para>Transaction ID (xid) offset in the
          template. The value is a positive integer.
          The -T switch must be used with -X.</para>
        </listitem>
      </varlistentry>

      <para>DHCPv4 only option:</para>
      <varlistentry>
        <term>
          <option>-B</option>
        </term>
        <listitem>
          <para>Force broadcast handling. This is a DHCPv4-only
          (-4) option, and is not compatible with IPv6 (-6).</para>
<!-- TODO: mention this is the default when "all" is the server name. -->
        </listitem>
      </varlistentry>

      <para>DHCPv6 only options:</para>
      <varlistentry>
        <term>
          <option>-c</option>
        </term>
        <listitem>
          <para>Add a rapid commit option (exchanges will be
          SA). This is a DHCPv6-only (-6) option.
          The -i switch must be set to use -c.</para>
        </listitem>
      </varlistentry>

      <para>The remaining options are used only in conjunction with
      -r:</para>

      <varlistentry>
        <term>
          <option>-D</option>
          <replaceable class="parameter">max-drop</replaceable>
        </term>
        <listitem>
          <para>Abort the test if more than
          <replaceable class="parameter">max-drop</replaceable>
          requests have been dropped. Use -D0
          to abort if even a single request has been dropped. If
          <replaceable class="parameter">max-drop</replaceable>
          includes the suffix '%', it
          specifies a maximum percentage of requests that may be
          dropped before abort. In this case, testing of the
          threshold begins after 10 requests have been expected to
          be received.</para>
          <para>The -D option must be used with the -r switch.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-n</option>
          <replaceable class="parameter">num-request</replaceable>
        </term>
        <listitem>
          <para>Initiate
          <replaceable class="parameter">num-request</replaceable>
          transactions.
          The value is a positive integer.
          No report is generated until all transactions have been
          initiated/waited-for after which a report is generated
          and the program terminates.</para>
          <para>The -n option must be used with the -r switch.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-p</option>
          <replaceable class="parameter">test-period</replaceable>
        </term>
        <listitem>
          <para>Send requests for the given test period, which is
          specified in the same manner as -d. This can be used as
          an alternative to -n, or both options can be given, in
          which case the testing is completed when either limit is
          reached. The value must be a positive integer.
          The -p option must be used with the -r switch.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>
          <option>-t</option>
          <replaceable class="parameter">report</replaceable>
        </term>
        <listitem>
          <para>Delay in seconds between two periodic
          reports. The value is a positive integer.
          The -t option must be used with the -r switch.</para>
        </listitem>
      </varlistentry>


<!--
TODO: where is this displayed?
        "Errors:\n"
        <varlistentry><term><option> tooshort</option></term><listitem><para>received a too short message\n"
        <varlistentry><term><option> orphans</option></term><listitem><para>received a message which doesn't match an exchange\n"
        "   (duplicate, late or not related)\n"
        <varlistentry><term><option> locallimit</option></term><listitem><para>reached to local system limits when sending a message.</para></listitem></varlistentry>

-->

    </variablelist>

  </refsect1>

  <refsect1>
    <title>EXIT STATUS</title>
    <para>
	The <command>perfdhcp</command> utility exits with one of
	the following values:
    </para>

    <variablelist>
      <varlistentry>
        <term>0</term>
        <listitem><simpara>Complete success.</simpara></listitem>
      </varlistentry>
      <varlistentry>
        <term>1</term>
        <listitem><simpara>General error.</simpara></listitem>
      </varlistentry>
      <varlistentry>
        <term>2</term>
	<listitem><simpara>An error in the command line
	arguments.</simpara></listitem>
      </varlistentry>
      <varlistentry>
        <term>3</term>
	<listitem><simpara>One or more exchanges were not successfully
	completed (and no general failures in operation).</simpara></listitem>
      </varlistentry>
    </variablelist>
  </refsect1>

  <refsect1>
    <title>SEE ALSO</title>
    <para>
      <citerefentry>
        <refentrytitle>b10-dhcp4</refentrytitle><manvolnum>8</manvolnum>
      </citerefentry>,
      <citerefentry>
        <refentrytitle>b10-dhcp6</refentrytitle><manvolnum>8</manvolnum>
      </citerefentry>,
      <citetitle>BIND 10 Guide</citetitle>.
    </para>
  </refsect1>

<!--
  <refsect1>
    <title>HISTORY</title>
    <para>
      The <command>perfdhcp</command> tool was first implemented
      by John Dubois in November 2011.
    </para>
  </refsect1>
-->

</refentry><!--
 - Local variables:
 - mode: sgml
 - End:
-->

<!--

        "perfdhcp [-hv] [-4|-6] [-r<rate>] [-t<report>] [-R<range>] [-b<base>]\n"
        "    [-n<num-request>] [-p<test-period>] [-d<drop-time>] [-D<max-drop>]\n"
        "    [-l<local-addr|interface>] [-P<preload>] [-a<aggressivity>]\n"
        "    [-L<local-port>] [-s<seed>] [-i] [-B] [-c] [-1]\n"
        "    [-T<template-file>] [-X<xid-offset>] [-O<random-offset]\n"
        "    [-E<time-offset>] [-S<srvid-offset>] [-I<ip-offset>]\n"
        "    [-x<diagnostic-selector>] [-w<wrapped>] [server]\n"
        "\n"
        "The [server] argument is the name/address of the DHCP server to\n"
        "contact.  For DHCPv4 operation, exchanges are initiated by\n"
        "transmitting a DHCP DISCOVER to this address.\n"
        "\n"
        "For DHCPv6 operation, exchanges are initiated by transmitting a DHCP\n"
        "SOLICIT to this address.  In the DHCPv6 case, the special name 'all'\n"
        "can be used to refer to All_DHCP_Relay_Agents_and_Servers (the\n"
        "multicast address FF02::1:2), or the special name 'servers' to refer\n"
        "to All_DHCP_Servers (the multicast address FF05::1:3).  The [server]\n"
        "argument is optional only in the case that -l is used to specify an\n"
        "interface, in which case [server] defaults to 'all'.\n"
        "\n"
        "The default is to perform a single 4-way exchange, effectively pinging\n"
        "the server.\n"
        "The -r option is used to set up a performance test, without\n"
        "it exchanges are initiated as fast as possible.\n"
-->
