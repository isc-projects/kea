<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN"
"http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd" [
<!ENTITY mdash  "&#x2014;" >
<!ENTITY % version SYSTEM "version.ent">
%version;
]>

<!--
 - Copyright (C) 2010-2012  Internet Systems Consortium, Inc. ("ISC")
 -
 - Permission to use, copy, modify, and/or distribute this software for any
 - purpose with or without fee is hereby granted, provided that the above
 - copyright notice and this permission notice appear in all copies.
 -
 - THE SOFTWARE IS PROVIDED "AS IS" AND ISC DISCLAIMS ALL WARRANTIES WITH
 - REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
 - AND FITNESS.  IN NO EVENT SHALL ISC BE LIABLE FOR ANY SPECIAL, DIRECT,
 - INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
 - LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE
 - OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
 - PERFORMANCE OF THIS SOFTWARE.
-->

<book>
  <?xml-stylesheet href="bind10-guide.css" type="text/css"?>

  <bookinfo>
    <title>BIND 10 Guide</title>
    <subtitle>Administrator Reference for BIND 10</subtitle>

    <copyright>
      <year>2010-2012</year><holder>Internet Systems Consortium, Inc.</holder>
    </copyright>

    <abstract>
      <para>BIND 10 is a framework that features Domain Name System
      (DNS) suite and Dynamic Host Configuration Protocol (DHCP)
      servers with development managed by Internet Systems Consortium (ISC).
      It includes DNS libraries, modular components for controlling
      authoritative and recursive DNS servers, and experimental DHCPv4
      and DHCPv6 servers.
      </para>
      <para>
        This is the reference guide for BIND 10 version &__VERSION__;.
        The most up-to-date version of this document (in PDF, HTML,
        and plain text formats), along with other documents for
        BIND 10, can be found at <ulink url="http://bind10.isc.org/docs"/>.
        </para> </abstract>

      <releaseinfo>This is the reference guide for BIND 10 version
        &__VERSION__;.</releaseinfo>

  </bookinfo>

  <preface>
    <title>Preface</title>

    <section id="acknowledgements">
      <title>Acknowledgements</title>

<!-- TODO: acknowledge all sponsors and CNNIC and CZNIC too -->

      <para>ISC would like to acknowledge generous support for
      BIND 10 development of DHCPv4 and DHCPv6 components provided
      by <ulink url="http://www.comcast.com/">Comcast</ulink>.</para>

    </section>

  </preface>

  <chapter id="intro">
    <title>Introduction</title>
    <para>
      BIND is the popular implementation of a DNS server, developer
      interfaces, and DNS tools.
      BIND 10 is a rewrite of BIND 9 and ISC DHCP.
      BIND 10 is written in C++ and Python and provides a modular
      environment for serving, maintaining, and developing DNS and DHCP.
      BIND 10 provides a EDNS0- and DNSSEC-capable authoritative
      DNS server and a caching recursive name server which also
      provides forwarding.
      It also provides experimental DHCPv4 and DHCPv6 servers.
    </para>

    <para>
      This guide covers the experimental prototype of
      BIND 10 version &__VERSION__;.
    </para>

    <section>
      <title>Supported Platforms</title>
      <para>
  BIND 10 builds have been tested on (in no particular order)
  Debian GNU/Linux 6 and unstable, Ubuntu 9.10, NetBSD 5,
  Solaris 10 and 11, FreeBSD 7 and 8, CentOS Linux 5.3,
  MacOS 10.6 and 10.7, and OpenBSD 5.1.

  It has been tested on Sparc, i386, and amd64 hardware
  platforms.

        It is planned for BIND 10 to build, install and run on
        Windows and standard Unix-type platforms.
      </para>
    </section>

    <section id="required-software">
      <title>Required Software at Run-time</title>

      <para>
        Running BIND 10 uses various extra software which may
        not be provided in some operating systems' default
        installations nor standard packages collections. You may
        need to install this required software separately.
        (For the build requirements, also see
        <xref linkend="build-requirements"/>.)
      </para>

      <para>
        BIND 10 requires at least Python 3.1
        (<ulink url="http://www.python.org/"/>).
        It also works with Python 3.2.
      </para>

      <para>
        BIND 10 uses the Botan crypto library for C++
        (<ulink url="http://botan.randombit.net/"/>).
        It requires at least Botan version 1.8.
      </para>

      <para>
        BIND 10 uses the log4cplus C++ logging library
        (<ulink url="http://log4cplus.sourceforge.net/"/>).
        It requires at least log4cplus version 1.0.3.
<!-- TODO: It is recommended to use at least version .... -->
      </para>

      <para>
        The authoritative DNS server uses SQLite3
        (<ulink url="http://www.sqlite.org/"/>).
<!-- TODO: is this still required? -->
        It needs at least SQLite version 3.3.9.
      </para>

      <para>
        The <command>b10-ddns</command>, <command>b10-xfrin</command>,
        <command>b10-xfrout</command>, and <command>b10-zonemgr</command>
        components require the libpython3 library and the Python
        _sqlite3.so module (which is included with Python).
        Python modules need to be built for the corresponding Python 3.
      </para>
<!-- TODO: this will change ... -->
    </section>

    <section id="starting_stopping">
      <title>Starting and Stopping the Server</title>

      <para>
        BIND 10 is modular.  Part of this modularity is
        accomplished using multiple cooperating processes which, together,
        provide the server functionality.  This is a change from
        the previous generation of BIND software, which used a
        single process.
      </para>

      <para>
        At first, running many different processes may seem confusing.
        However, these processes are started, stopped, and maintained
        by a single command, <command>bind10</command>.
        This command starts a master process which will start other
        processes as needed.
        The processes started by the <command>bind10</command>
        command have names starting with "b10-", including:
      </para>

      <para>

        <itemizedlist>

          <listitem>
            <simpara>
              <command>b10-auth</command> &mdash;
              Authoritative DNS server.
              This process serves DNS requests.
            </simpara>
          </listitem>

          <listitem>
            <simpara>
              <command>b10-cfgmgr</command> &mdash;
              Configuration manager.
              This process maintains all of the configuration for BIND 10.
            </simpara>
          </listitem>

          <listitem>
            <simpara>
              <command>b10-cmdctl</command> &mdash;
              Command and control service.
              This process allows external control of the BIND 10 system.
            </simpara>
          </listitem>

          <listitem>
            <simpara>
              <command>b10-ddns</command> &mdash;
              Dynamic DNS update service.
              This process is used to handle incoming DNS update
              requests to allow granted clients to update zones
	      for which BIND 10 is serving as a primary server.
            </simpara>
          </listitem>

          <listitem>
            <simpara>
              <command>b10-msgq</command> &mdash;
              Message bus daemon.
              This process coordinates communication between all of the other
              BIND 10 processes.
            </simpara>
          </listitem>

          <listitem>
            <simpara>
              <command>b10-resolver</command> &mdash;
              Recursive name server.
              This process handles incoming DNS queries and provides
              answers from its cache or by recursively doing remote lookups.
            </simpara>
          </listitem>

          <listitem>
            <simpara>
              <command>b10-sockcreator</command> &mdash;
              Socket creator daemon.
              This process creates sockets used by
              network-listening BIND 10 processes.
            </simpara>
          </listitem>

          <listitem>
            <simpara>
              <command>b10-stats</command> &mdash;
              Statistics collection daemon.
              This process collects and reports statistics data.
            </simpara>
          </listitem>

          <listitem>
            <simpara>
              <command>b10-stats-httpd</command> &mdash;
              HTTP server for statistics reporting.
              This process reports statistics data in XML format over HTTP.
            </simpara>
          </listitem>

          <listitem>
            <simpara>
              <command>b10-xfrin</command> &mdash;
              Incoming zone transfer service.
              This process is used to transfer a new copy
              of a zone into BIND 10, when acting as a secondary server.
            </simpara>
          </listitem>

          <listitem>
            <simpara>
              <command>b10-xfrout</command> &mdash;
              Outgoing zone transfer service.
              This process is used to handle transfer requests to
              send a local zone to a remote secondary server.
            </simpara>
          </listitem>

          <listitem>
            <simpara>
              <command>b10-zonemgr</command> &mdash;
              Secondary zone manager.
              This process keeps track of timers and other
              necessary information for BIND 10 to act as a slave server.
            </simpara>
          </listitem>

        </itemizedlist>
      </para>

      <para>
        These are ran by <command>bind10</command>
        and do not need to be manually started independently.
      </para>

    </section>

    <section id="managing_once_running">
      <title>Managing BIND 10</title>

      <para>
        Once BIND 10 is running, a few commands are used to interact
        directly with the system:
        <itemizedlist>
          <listitem>
            <simpara>
              <command>bindctl</command> &mdash;
              Interactive administration interface.
              This is a low-level command-line tool which allows
              a developer or an experienced administrator to control
              BIND 10.
            </simpara>
          </listitem>
          <listitem>
            <simpara>
              <command>b10-loadzone</command> &mdash;
              Zone file loader.
              This tool will load standard masterfile-format zone files into
              BIND 10.
            </simpara>
          </listitem>
          <listitem>
            <simpara>
              <command>b10-cmdctl-usermgr</command> &mdash;
              User access control.
              This tool allows an administrator to authorize additional users
              to manage BIND 10.
            </simpara>
          </listitem>
  <!-- TODO usermgr -->
        </itemizedlist>
      </para>
    </section>

    <para>
      The tools and modules are covered in full detail in this guide.
<!-- TODO point to these -->
      In addition, manual pages are also provided in the default installation.
    </para>

<!--
bin/
  bindctl*
  host*
lib/
  libauth
  libdns
  libexceptions
  python3.1/site-packages/isc/{cc,config}
sbin/
  bind10
share/
  share/bind10/
    auth.spec
    b10-cmdctl.pem
    bob.spec
    passwd.csv
  man/
var/
  bind10/b10-config.db
-->

    <para>
      BIND 10 also provides libraries and programmer interfaces
      for C++ and Python for the message bus, configuration backend,
      and, of course, DNS. These include detailed developer
      documentation and code examples.
<!-- TODO: DHCP also but no Python yet. -->
<!-- TODO point to this -->
    </para>

  </chapter>

  <chapter id="installation">
    <title>Installation</title>

    <section id="packages">
      <title>Packages</title>

      <para>
        Some operating systems or softare package vendors may
        provide ready-to-use, pre-built software packages for
        the BIND 10 suite.
        Installing a pre-built package means you do not need to
        install build-only prerequisites and do not need to
        <emphasis>make</emphasis> the software.
      </para>

      <para>
        FreeBSD ports, NetBSD pkgsrc, and Debian
        <emphasis>testing</emphasis> package collections provide
        all the prerequisite packages.
      </para>
    </section>

    <section id="install-hierarchy">
      <title>Install Hierarchy</title>
      <para>
        The following is the standard, common layout of the
        complete BIND 10 installation:
        <itemizedlist>
          <listitem>
           <simpara>
              <filename>bin/</filename> &mdash;
              general tools and diagnostic clients.
            </simpara>
          </listitem>
          <listitem>
          <simpara>
            <filename>etc/bind10-devel/</filename> &mdash;
            configuration files.
          </simpara>
          </listitem>
          <listitem>
            <simpara>
              <filename>lib/</filename> &mdash;
              libraries and python modules.
            </simpara>
          </listitem>
          <listitem>
            <simpara>
              <filename>libexec/bind10-devel/</filename> &mdash;
              executables that a user wouldn't normally run directly and
              are not run independently.
              These are the BIND 10 modules which are daemons started by
              the <command>bind10</command> tool.
            </simpara>
          </listitem>
          <listitem>
            <simpara>
              <filename>sbin/</filename> &mdash;
              commands used by the system administrator.
            </simpara>
          </listitem>
          <listitem>
            <simpara>
              <filename>share/bind10-devel/</filename> &mdash;
              configuration specifications.
            </simpara>
          </listitem>
          <listitem>
            <simpara>
              <filename>share/doc/bind10-devel/</filename> &mdash;
              this guide and other supplementary documentation.
            </simpara>
          </listitem>
          <listitem>
            <simpara>
              <filename>share/man/</filename> &mdash;
              manual pages (online documentation).
            </simpara>
          </listitem>
          <listitem>
            <simpara>
              <filename>var/bind10-devel/</filename> &mdash;
              data source and configuration databases.
            </simpara>
          </listitem>
        </itemizedlist>
      </para>
    </section>

    <section id="build-requirements">
      <title>Building Requirements</title>

        <para>
          In addition to the run-time requirements (listed in
          <xref linkend="required-software"/>), building BIND 10
          from source code requires various development include headers and
          program development tools.
        </para>

        <note>
          <simpara>
            Some operating systems have split their distribution packages into
            a run-time and a development package.  You will need to install
            the development package versions, which include header files and
            libraries, to build BIND 10 from source code.
          </simpara>
        </note>

        <para>
          Building from source code requires the Boost
          build-time headers
          (<ulink url="http://www.boost.org/"/>).
          At least Boost version 1.35 is required.
  <!-- TODO: we don't check for this version -->
  <!-- NOTE: jreed has tested with 1.34, 1.38, and 1.41. -->
        </para>

        <para>
          To build BIND 10, also install the Botan (at least version
          1.8) and the log4cplus (at least version 1.0.3)
          development include headers.
        </para>

<!--
TODO
Debian and Ubuntu:
 libgmp3-dev and libbz2-dev required for botan too
-->

<!-- NOTE: _sqlite3 is only needed at test time; it is already listed
as a dependency earlier -->

        <para>
          Building BIND 10 also requires a C++ compiler and
          standard development headers, make, and pkg-config.
          BIND 10 builds have been tested with GCC g++ 3.4.3, 4.1.2,
          4.1.3, 4.2.1, 4.3.2, and 4.4.1; Clang++ 2.8; and Sun C++ 5.10.
        </para>

        <para>
          Visit the user-contributed wiki at <ulink
          url="http://bind10.isc.org/wiki/SystemSpecificNotes" />
          for system-specific installation tips.
        </para>

    </section>

    <section id="quickstart">
      <title>Quick start</title>
      <note>
        <simpara>
          This quickly covers the standard steps for installing
          and deploying BIND 10 as an authoritative name server using
          its defaults. For troubleshooting, full customizations and further
          details, see the respective chapters in the BIND 10 guide.
        </simpara>
      </note>

      <para>
        To quickly get started with BIND 10, follow these steps.
      </para>

      <orderedlist>

        <listitem>
          <simpara>
            Install required run-time and build dependencies.
          </simpara>
        </listitem>

        <listitem>
          <simpara>
            Download the BIND 10 source tar file from
            <ulink url="ftp://ftp.isc.org/isc/bind10/"/>.
          </simpara>
        </listitem>

        <listitem>
          <para>Extract the tar file:
          <screen>$ <userinput>gzcat bind10-<replaceable>VERSION</replaceable>.tar.gz | tar -xvf -</userinput></screen>
          </para>
        </listitem>

        <listitem>
          <para>Go into the source and run configure:
            <screen>$ <userinput>cd bind10-<replaceable>VERSION</replaceable></userinput>
  $ <userinput>./configure</userinput></screen>
          </para>
        </listitem>

        <listitem>
          <para>Build it:
            <screen>$ <userinput>make</userinput></screen>
          </para>
        </listitem>

        <listitem>
          <para>Install it (to default /usr/local):
            <screen>$ <userinput>make install</userinput></screen>
          </para>
        </listitem>

        <listitem>
          <para>Start the server:
            <screen>$ <userinput>/usr/local/sbin/bind10</userinput></screen>
          </para>
        </listitem>

        <listitem>
<!-- TODO: this is wrong; b10-auth is not started by default any more -->
         <para>Test it; for example:
            <screen>$ <userinput>dig @127.0.0.1 -c CH -t TXT authors.bind</userinput></screen>
         </para>
        </listitem>

        <listitem>
          <para>Load desired zone file(s), for example:
            <screen>$ <userinput>b10-loadzone <replaceable>your.zone.example.org</replaceable></userinput></screen>
          </para>
        </listitem>

        <listitem>
          <simpara>
            Test the new zone.
          </simpara>
        </listitem>

      </orderedlist>

    </section>

    <section id="install">
      <title>Installation from source</title>
      <para>
        BIND 10 is open source software written in C++ and Python.
        It is freely available in source code form from ISC as a
        downloadable tar file or via BIND 10's Git code revision control
        service. (It may also be available in pre-compiled ready-to-use
        packages from operating system vendors.)
      </para>

      <section>
        <title>Download Tar File</title>
        <para>
          Downloading a release tar file is the recommended method to
          obtain the source code.
        </para>

        <para>
          The BIND 10 releases are available as tar file downloads from
          <ulink url="ftp://ftp.isc.org/isc/bind10/"/>.
          Periodic development snapshots may also be available.
        </para>
  <!-- TODO -->
      </section>

      <section>
        <title>Retrieve from Git</title>
        <para>
          Downloading this "bleeding edge" code is recommended only for
          developers or advanced users.  Using development code in a production
          environment is not recommended.
        </para>

        <note>
          <para>
            When using source code retrieved via Git, additional
            software will be required:  automake (v1.11 or newer),
            libtoolize, and autoconf (2.59 or newer).
            These may need to be installed.
          </para>
        </note>

        <para>
          The latest development code (and temporary experiments
          and un-reviewed code) is available via the BIND 10 code revision
          control system. This is powered by Git and all the BIND 10
          development is public.
          The leading development is done in the <quote>master</quote>
          branch.
        </para>
        <para>
          The code can be checked out from
          <filename>git://git.bind10.isc.org/bind10</filename>;
          for example:

        <screen>$ <userinput>git clone git://git.bind10.isc.org/bind10</userinput></screen>
        </para>

        <para>
          When checking out the code from
          the code version control system, it doesn't include the
          generated configure script, Makefile.in files, nor their
          related build files.
          They can be created by running <command>autoreconf</command>
          with the <option>--install</option> switch.
          This will run <command>autoconf</command>,
          <command>aclocal</command>,
          <command>libtoolize</command>,
          <command>autoheader</command>,
          <command>automake</command>,
          and related commands.
        </para>

      </section>


      <section>
        <title>Configure before the build</title>
        <para>
          BIND 10 uses the GNU Build System to discover build environment
          details.
          To generate the makefiles using the defaults, simply run:
          <screen>$ <userinput>./configure</userinput></screen>
        </para>
        <para>
          Run <command>./configure</command> with the <option>--help</option>
          switch to view the different options. Some commonly-used options are:

          <variablelist>

          <varlistentry>
            <term>--prefix</term>
            <listitem>
              <simpara>Define the installation location (the
                default is <filename>/usr/local/</filename>).
              </simpara>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>--with-boost-include</term>
            <listitem>
              <simpara>Define the path to find the Boost headers.
              </simpara>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>--with-pythonpath</term>
            <listitem>
              <simpara>Define the path to Python 3.1 if it is not in the
                standard execution path.
              </simpara>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>--with-gtest</term>
            <listitem>
              <simpara>Enable building the C++ Unit Tests using the
                Google Tests framework. Optionally this can define the
                path to the gtest header files and library.
              </simpara>
            </listitem>
          </varlistentry>

          </variablelist>

        </para>
  <!-- TODO: lcov -->

        <para>
          For example, the following configures it to
    find the Boost headers, find the
    Python interpreter, and sets the installation location:

          <screen>$ <userinput>./configure \
      --with-boost-include=/usr/pkg/include \
      --with-pythonpath=/usr/pkg/bin/python3.1 \
      --prefix=/opt/bind10</userinput></screen>
        </para>

        <para>
          If the configure fails, it may be due to missing or old
          dependencies.
        </para>

      </section>

      <section>
        <title>Build</title>
        <para>
    After the configure step is complete, to build the executables
    from the C++ code and prepare the Python scripts, run:

          <screen>$ <userinput>make</userinput></screen>
        </para>
      </section>

      <section>
        <title>Install</title>
        <para>
          To install the BIND 10 executables, support files,
          and documentation, run:
          <screen>$ <userinput>make install</userinput></screen>
        </para>
        <note>
          <para>The install step may require superuser privileges.</para>
        </note>

      </section>

  <!-- TODO: tests -->

    </section>

  <!--
      <section id="install.troubleshooting">
        <title>Troubleshooting</title>
        <para>
        </para>
      </section>
  -->

  </chapter>

  <chapter id="bind10">
    <title>Starting BIND10 with <command>bind10</command></title>
    <para>
      BIND 10 provides the <command>bind10</command> command which
      starts up the required processes.
      <command>bind10</command>
      will also restart some processes that exit unexpectedly.
      This is the only command needed to start the BIND 10 system.
    </para>

    <para>
      After starting the <command>b10-msgq</command> communications channel,
      <command>bind10</command> connects to it,
      runs the configuration manager, and reads its own configuration.
      Then it starts the other modules.
    </para>

    <para>
      The <command>b10-sockcreator</command>, <command>b10-msgq</command> and
      <command>b10-cfgmgr</command>
      services make up the core. The <command>b10-msgq</command> daemon
      provides the communication channel between every part of the system.
      The <command>b10-cfgmgr</command> daemon is always needed by every
      module, if only to send information about themselves somewhere,
      but more importantly to ask about their own settings, and
      about other modules. The <command>b10-sockcreator</command> daemon
      helps allocate Internet addresses and ports as needed for BIND 10
      network services.
    </para>

    <para>
      In its default configuration, the <command>bind10</command>
      master process will also start up
      <command>b10-cmdctl</command> for administration tools to
      communicate with the system, and
      <command>b10-stats</command> for statistics collection.
    </para>

    <section id="start">
      <title>Starting BIND 10</title>
      <para>
        To start the BIND 10 service, simply run <command>bind10</command>.
        Run it with the <option>--verbose</option> switch to
        get additional debugging or diagnostic output.
      </para>
<!-- TODO: note it doesn't go into background -->

      <note>
        <para>
          If the setproctitle Python module is detected at start up,
          the process names for the Python-based daemons will be renamed
          to better identify them instead of just <quote>python</quote>.
          This is not needed on some operating systems.
        </para>
      </note>

    </section>
    <section id="bind10.config">
      <title>Configuration to start processes</title>

      <para>
	The processes to be used can be configured for
	<command>bind10</command> to start, with the exception
	of the required <command>b10-sockcreator</command>,
	<command>b10-msgq</command> and <command>b10-cfgmgr</command>
	components.
	The configuration is in the <varname>Boss/components</varname>
	section. Each element represents one component, which is
	an abstraction of a process.
      </para>

      <para>
	To add a process to the set, let's say the resolver (which
	is not started by default), you would do this:
        <screen>&gt; <userinput>config add Boss/components b10-resolver</userinput>
&gt; <userinput>config set Boss/components/b10-resolver/special resolver</userinput>
&gt; <userinput>config set Boss/components/b10-resolver/kind needed</userinput>
&gt; <userinput>config set Boss/components/b10-resolver/priority 10</userinput>
&gt; <userinput>config commit</userinput></screen></para>

      <para>
	Now, what it means. We add an entry called
	<quote>b10-resolver</quote>. It is both a name used to
	reference this component in the configuration and the name
	of the process to start. Then we set some parameters on
	how to start it.
      </para>

      <para>
	The <varname>special</varname> setting is for components
	that need some kind of special care during startup or
	shutdown. Unless specified, the component is started in a
	usual way. This is the list of components that need to be
	started in a special way, with the value of special used
	for them:
<!-- TODO: this still doesn't explain why they are special -->
        <table>
          <title>Special startup components</title>
          <tgroup cols='3' align='left'>
          <colspec colname='component'/>
          <colspec colname='special'/>
          <colspec colname='description'/>
          <thead><row><entry>Component</entry><entry>Special</entry><entry>Description</entry></row></thead>
          <tbody>
            <row><entry>b10-auth</entry><entry>auth</entry><entry>Authoritative DNS server</entry></row>
            <row><entry>b10-resolver</entry><entry>resolver</entry><entry>DNS resolver</entry></row>
            <row><entry>b10-cmdctl</entry><entry>cmdctl</entry><entry>Command control (remote control interface)</entry></row>
            <!-- TODO Either add xfrin and xfrout as well or clean up the workarounds in boss before the release -->
          </tbody>
          </tgroup>
        </table>
      </para>

      <para>
	The <varname>kind</varname> specifies how a failure of the
	component should be handled.  If it is set to
	<quote>dispensable</quote> (the default unless you set
	something else), it will get started again if it fails. If
	it is set to <quote>needed</quote> and it fails at startup,
	the whole <command>bind10</command> shuts down and exits
	with an error exit code. But if it fails some time later, it
	is just started again. If you set it to <quote>core</quote>,
	you indicate that the system is not usable without the
	component and if such component fails, the system shuts
	down no matter when the failure happened.  This is the
	behaviour of the core components (the ones you can't turn
	off), but you can declare any other components as core as
	well if you wish (but you can turn these off, they just
	can't fail).
      </para>

      <para>
	The <varname>priority</varname> defines order in which the
	components should start.  The ones with higher numbers are
	started sooner than the ones with lower ones. If you don't
	set it, 0 (zero) is used as the priority.  Usually, leaving
	it at the default is enough.
      </para>

      <para>
        There are other parameters we didn't use in our example.
        One of them is <varname>address</varname>. It is the address
        used by the component on the <command>b10-msgq</command>
        message bus. The special components already know their
        address, but the usual ones don't. The address is by
        convention the thing after <emphasis>b10-</emphasis>, with
        the first letter capitalized (eg. <command>b10-stats</command>
        would have <quote>Stats</quote> as its address).
<!-- TODO: this should be simplified so we don't even have to document it -->
      </para>

<!-- TODO: what does "The special components already know their
address, but the usual ones don't." mean? -->

<!-- TODO: document params when is enabled -->

      <para>
	The last one is <varname>process</varname>. It is the name
	of the process to be started.  It defaults to the name of
	the component if not set, but you can use this to override
	it. (The special components also already know their
        executable name.)
      </para>

      <!-- TODO Add parameters when they work, not implemented yet-->

      <note>
        <para>
          The configuration is quite powerful, but that includes
          a lot of space for mistakes. You could turn off the
          <command>b10-cmdctl</command>, but then you couldn't
          change it back the usual way, as it would require it to
          be running (you would have to find and edit the configuration
          directly).  Also, some modules might have dependencies:
          <command>b10-stats-httpd</command> needs
          <command>b10-stats</command>, <command>b10-xfrout</command>
          needs <command>b10-auth</command> to be running, etc.

<!-- TODO: should we define dependencies? -->

        </para>
        <para>
          In short, you should think twice before disabling something here.
        </para>
      </note>
      <para>
        It is possible to start some components multiple times (currently
        <command>b10-auth</command> and <command>b10-resolver</command>).
        You might want to do that to gain more performance (each one uses only
        single core). Just put multiple entries under different names, like
        this, with the same config:
        <screen>&gt; <userinput>config add Boss/components b10-resolver-2</userinput>
&gt; <userinput>config set Boss/components/b10-resolver-2/special resolver</userinput>
&gt; <userinput>config set Boss/components/b10-resolver-2/kind needed</userinput>
&gt; <userinput>config commit</userinput></screen>
      </para>
      <para>
        However, this is work in progress and the support is not yet complete.
        For example, each resolver will have its own cache, each authoritative
        server will keep its own copy of in-memory data and there could be
        problems with locking the sqlite database, if used. The configuration
        might be changed to something more convenient in future.
	Other components don't expect such a situation, so it would
	probably not do what you want. Such support is yet to be
	implemented.
      </para>
    </section>

  </chapter>

  <chapter id="msgq">
    <title>Command channel</title>

      <para>
        The BIND 10 components use the <command>b10-msgq</command>
        message routing daemon to communicate with other BIND 10 components.
        The <command>b10-msgq</command> implements what is called the
        <quote>Command Channel</quote>.
        Processes intercommunicate by sending messages on the command
        channel.
        Example messages include shutdown, get configurations, and set
        configurations.
        This Command Channel is not used for DNS message passing.
        It is used only to control and monitor the BIND 10 system.
      </para>

      <para>
        Administrators do not communicate directly with the
        <command>b10-msgq</command> daemon.
        By default, BIND 10 uses a UNIX domain socket file named
        <filename>/usr/local/var/bind10-devel/msg_socket</filename>
        for this interprocess communication.
      </para>

  </chapter>

  <chapter id="cfgmgr">
    <title>Configuration manager</title>

      <para>
         The configuration manager, <command>b10-cfgmgr</command>,
         handles all BIND 10 system configuration.  It provides
         persistent storage for configuration, and notifies running
         modules of configuration changes.
      </para>

      <para>
        The <command>b10-auth</command> and <command>b10-xfrin</command>
        daemons and other components receive their configurations
        from the configuration manager over the <command>b10-msgq</command>
        command channel.
      </para>

      <para>The administrator doesn't connect to it directly, but
        uses a user interface to communicate with the configuration
        manager via <command>b10-cmdctl</command>'s REST-ful interface.
        <command>b10-cmdctl</command> is covered in <xref linkend="cmdctl"/>.
      </para>

<!-- TODO -->
      <note>
        <para>
          The development prototype release only provides
          <command>bindctl</command> as a user interface to
          <command>b10-cmdctl</command>.
          Upcoming releases will provide another interactive command-line
          interface and a web-based interface.
        </para>
      </note>

      <para>
        The <command>b10-cfgmgr</command> daemon can send all
        specifications and all current settings to the
        <command>bindctl</command> client (via
        <command>b10-cmdctl</command>).
        <command>b10-cfgmgr</command> relays configurations received
        from <command>b10-cmdctl</command> to the appropriate modules.
      </para>
<!-- TODO:
        Configuration settings for itself are defined as ConfigManager.
TODO: show examples
-->

<!-- TODO:
config changes are actually commands to cfgmgr
-->

<!-- TODO: what about run time config to change this? -->
<!-- jelte: > config set cfgmgr/config_database <file> -->
<!-- TODO: what about command line switch to change this? -->
      <para>
        The stored configuration file is at
        <filename>/usr/local/var/bind10-devel/b10-config.db</filename>.
        (The directory is what was defined at build configure time for
        <option>--localstatedir</option>.
        The default is <filename>/usr/local/var/</filename>.)
        The format is loosely based on JSON and is directly parseable
        python, but this may change in a future version.
        This configuration data file is not manually edited by the
        administrator.
      </para>

<!--

Well the specfiles have a more fixed format (they must contain specific
stuff), but those are also directly parseable python structures (and
'coincidentally', our data::element string representation is the same)

loosely based on json, tweaked to be directly parseable in python, but a
subset of that.
wiki page is http://bind10.isc.org/wiki/DataElementDesign

nope, spec files are written by module developers, and db should be done
through bindctl and friends

-->

    <para>
      The configuration manager does not have any command line arguments.
      Normally it is not started manually, but is automatically
      started using the <command>bind10</command> master process
      (as covered in <xref linkend="bind10"/>).
    </para>

<!-- TODO: upcoming plans:
configuration for configuration manager itself. And perhaps we might
change the messaging protocol, but an admin should never see any of that
-->

<!-- TODO: show examples, test this -->
<!--
, so an admin can simply run bindctl,
do config show, and it shows all modules; config show >module> shows all
options for that module
-->

  </chapter>

  <chapter id="cmdctl">
    <title>Remote control daemon</title>

    <para>
      <command>b10-cmdctl</command> is the gateway between
      administrators and the BIND 10 system.
      It is a HTTPS server that uses standard HTTP Digest
      Authentication for username and password validation.
      It provides a REST-ful interface for accessing and controlling
      BIND 10.
    </para>
<!-- TODO: copy examples from wiki, try with wget -->

    <para>
      When <command>b10-cmdctl</command> starts, it firsts
      asks <command>b10-cfgmgr</command> about what modules are
      running and what their configuration is (over the
      <command>b10-msgq</command> channel). Then it will start listening
      on HTTPS for clients &mdash; the user interface &mdash; such
      as <command>bindctl</command>.
    </para>

    <para>
      <command>b10-cmdctl</command> directly sends commands
      (received from the user interface) to the specified component.
      Configuration changes are actually commands to
      <command>b10-cfgmgr</command> so are sent there.
    </para>

<!--
TODO:
"For bindctl to list a module's available configurations and
available commands, it communicates over the cmdctl REST interface.
cmdctl then asks cfgmgr over the msgq command channel. Then cfgmgr
asks the module for its specification and also cfgmgr looks in its
own configuration database for current values."

(05:32:03) jelte: i think cmdctl doesn't request it upon a incoming
GET, but rather requests it once and then listens in for updates,
but you might wanna check with likun
-->

<!-- TODO: replace /usr/local -->
<!-- TODO: permissions -->
    <para>The HTTPS server requires a private key,
      such as a RSA PRIVATE KEY.
      The default location is at
      <filename>/usr/local/etc/bind10-devel/cmdctl-keyfile.pem</filename>.
      (A sample key is at
      <filename>/usr/local/share/bind10-devel/cmdctl-keyfile.pem</filename>.)
      It also uses a certificate located at
      <filename>/usr/local/etc/bind10-devel/cmdctl-certfile.pem</filename>.
      (A sample certificate is at
      <filename>/usr/local/share/bind10-devel/cmdctl-certfile.pem</filename>.)
      This may be a self-signed certificate or purchased from a
      certification authority.
    </para>

    <note><para>
      The HTTPS server doesn't support a certificate request from a
      client (at this time).
<!-- TODO: maybe allow request from server side -->
      The <command>b10-cmdctl</command> daemon does not provide a
      public service. If any client wants to control BIND 10, then
      a certificate needs to be first received from the BIND 10
      administrator.
      The BIND 10 installation provides a sample PEM bundle that matches
      the sample key and certificate.
    </para></note>
<!-- TODO: cross-ref -->

<!-- TODO
openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes
but that is a single file, maybe this should go back to that format?
-->

<!--
    <para>
(08:20:56) shane: It is in theory possible to run without cmdctl.
(08:21:02) shane: I think we discussed this.
    </para>
-->

<!-- TODO: Please check https://bind10.isc.org/wiki/cmd-ctrld -->


    <para>
      The <command>b10-cmdctl</command> daemon also requires
      the user account file located at
      <filename>/usr/local/etc/bind10-devel/cmdctl-accounts.csv</filename>.
      This comma-delimited file lists the accounts with a user name,
      hashed password, and salt.
      (A sample file is at
      <filename>/usr/local/share/bind10-devel/cmdctl-accounts.csv</filename>.
      It contains the user named <quote>root</quote> with the password
      <quote>bind10</quote>.)
    </para>

    <para>
      The administrator may create a user account with the
      <command>b10-cmdctl-usermgr</command> tool.
    </para>
<!-- TODO: show example -->

<!-- TODO: does cmdctl need to be restarted to change cert or key
or accounts database -->

    <para>
      By default the HTTPS server listens on the localhost port 8080.
      The port can be set by using the <option>--port</option> command line option.
      The address to listen on can be set using the <option>--address</option> command
      line argument.
      Each HTTPS connection is stateless and times out in 1200 seconds
      by default.  This can be
      redefined by using the <option>--idle-timeout</option> command line argument.
    </para>

    <section id="cmdctl.spec">
      <title>Configuration specification for b10-cmdctl</title>
      <para>
        The configuration items for <command>b10-cmdctl</command> are:
        <varname>accounts_file</varname> which defines the path to the
        user accounts database (the default is
        <filename>/usr/local/etc/bind10-devel/cmdctl-accounts.csv</filename>);
        <varname>cert_file</varname> which defines the path to the
        PEM certificate file (the default is
        <filename>/usr/local/etc/bind10-devel/cmdctl-certfile.pem</filename>);
        and
	<varname>key_file</varname> which defines the path to the
	PEM private key file (the default is
        <filename>/usr/local/etc/bind10-devel/cmdctl-keyfile.pem</filename>).
      </para>

    </section>

<!--
TODO
(12:21:30) jinmei: I'd like to have sample session using a command line www client such as wget
-->

  </chapter>

  <chapter id="bindctl">
    <title>Control and configure user interface</title>

    <note><para>
      For this development prototype release, <command>bindctl</command>
      is the only user interface. It is expected that upcoming
      releases will provide another interactive command-line
      interface and a web-based interface for controlling and
      configuring BIND 10.
    </para></note>

    <para>
      The <command>bindctl</command> tool provides an interactive
      prompt for configuring, controlling, and querying the BIND 10
      components.
      It communicates directly with a REST-ful interface over HTTPS
      provided by <command>b10-cmdctl</command>. It doesn't
      communicate to any other components directly.
    </para>

<!-- TODO: explain and show interface -->

    <para>
      Configuration changes are actually commands to
      <command>b10-cfgmgr</command>. So when <command>bindctl</command>
      sends a configuration, it is sent to <command>b10-cmdctl</command>
      (over a HTTPS connection); then <command>b10-cmdctl</command>
      sends the command (over a <command>b10-msgq</command> command
      channel) to <command>b10-cfgmgr</command> which then stores
      the details and relays (over a <command>b10-msgq</command> command
      channel) the configuration on to the specified module.
    </para>

    <para>
    </para>

  </chapter>

  <chapter id="authserver">
    <title>Authoritative Server</title>

    <para>
      The <command>b10-auth</command> is the authoritative DNS server.
      It supports EDNS0, DNSSEC, IPv6, and SQLite3 and in-memory zone
      data backends.
      Normally it is started by the <command>bind10</command> master
      process.
    </para>

    <section>
      <title>Server Configurations</title>

<!-- TODO: offers command line options but not used
since we used bind10 -->

      <para>
        <command>b10-auth</command> is configured via the
        <command>b10-cfgmgr</command> configuration manager.
        The module name is <quote>Auth</quote>.
        The configuration data items are:

        <variablelist>

          <varlistentry>
            <term>database_file</term>
            <listitem>
              <simpara>This is an optional string to define the path to find
                 the SQLite3 database file.
<!-- TODO: -->
Note: This may be a temporary setting because the DNS server
can use various data source backends.
              </simpara>
            </listitem>
          </varlistentry>

<!-- NOTE: docs pulled in verbatim from the b10-auth.xml manual page.
     TODO: automate this if want this or rewrite
-->
          <varlistentry>
            <term>datasources</term>
            <listitem>
              <simpara>
      <varname>datasources</varname> configures data sources.
      The list items include:
      <varname>type</varname> to define the required data source type
      (such as <quote>memory</quote>);
      <varname>class</varname> to optionally select the class
      (it defaults to <quote>IN</quote>);
      and
      <varname>zones</varname> to define
      the <varname>file</varname> path name,
      the <varname>filetype</varname> (<quote>sqlite3</quote> to load
      from a SQLite3 database file or <quote>text</quote> to
      load from a master text file),
      and the <varname>origin</varname> (default domain).

      By default, this is empty.

      <note><simpara>
        In this development version, currently this is only used for the
        memory data source.
        Only the IN class is supported at this time.
        By default, the memory data source is disabled.
        Also, currently the zone file must be canonical such as
        generated by <command>named-compilezone -D</command>, or
        must be an SQLite3 database.
      </simpara></note>

              </simpara>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>listen_on</term>
            <listitem>
              <simpara>
      <varname>listen_on</varname> is a list of addresses and ports for
      <command>b10-auth</command> to listen on.
      The list items are the <varname>address</varname> string
      and <varname>port</varname> number.
      By default, <command>b10-auth</command> listens on port 53
      on the IPv6 (::) and IPv4 (0.0.0.0) wildcard addresses.
      <note>
        <simpara>
          The default configuration is currently not appropriate for a multi-homed host.
          In case you have multiple public IP addresses, it is possible the
          query UDP packet comes through one interface and the answer goes out
          through another. The answer will probably be dropped by the client, as it
          has a different source address than the one it sent the query to. The
          client would fallback on TCP after several attempts, which works
          well in this situation, but is clearly not ideal.
        </simpara>
        <simpara>
          There are plans to solve the problem such that the server handles
          it by itself. But until it is actually implemented, it is recommended to
          alter the configuration &mdash; remove the wildcard addresses and list all
          addresses explicitly. Then the server will answer on the same
          interface the request came on, preserving the correct address.
        </simpara>
      </note>
              </simpara>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>statistics-interval</term>
            <listitem>
              <simpara>
      <varname>statistics-interval</varname> is the timer interval
      in seconds for <command>b10-auth</command> to share its
      statistics information to
      <citerefentry><refentrytitle>b10-stats</refentrytitle><manvolnum>8</manvolnum></citerefentry>.
      Statistics updates can be disabled by setting this to 0.
      The default is 60.
              </simpara>
            </listitem>
          </varlistentry>

        </variablelist>

      </para>

      <para>

        The configuration commands are:

        <variablelist>

          <varlistentry>
            <term>loadzone</term>
            <listitem>
              <simpara>
      <command>loadzone</command> tells <command>b10-auth</command>
      to load or reload a zone file. The arguments include:
      <varname>class</varname> which optionally defines the class
      (it defaults to <quote>IN</quote>);
      <varname>origin</varname> is the domain name of the zone;
      and
      <varname>datasrc</varname> optionally defines the type of datasource
      (it defaults to <quote>memory</quote>).

      <note><simpara>
        In this development version, currently this only supports the
        IN class and the memory data source.
      </simpara></note>
              </simpara>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>sendstats</term>
            <listitem>
              <simpara>
      <command>sendstats</command> tells <command>b10-auth</command>
      to send its statistics data to
      <citerefentry><refentrytitle>b10-stats</refentrytitle><manvolnum>8</manvolnum></citerefentry>
      immediately.
              </simpara>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>shutdown</term>
            <listitem>
              <simpara>Stop the authoritative DNS server.
      This has an optional <varname>pid</varname> argument to
      select the process ID to stop.
      (Note that the BIND 10 boss process may restart this service
      if configured.)
              </simpara>
            </listitem>
          </varlistentry>

        </variablelist>

      </para>

<!-- TODO: examples of setting or running above? -->

    </section>

    <section id='datasrc'>
      <title>Data Source Backends</title>

      <para>
        Bind 10 has the concept of data sources. A data source is a place
        where authoritative zone data reside and where they can be served
        from. This can be a master file, a database or something completely
        different.
      </para>

      <para>
        Once a query arrives, <command>b10-auth</command> goes through a
        configured list of data sources and finds the one containing a best
        matching zone. From the equally good ones, the first one is taken.
        This data source is then used to answer the query.
      </para>

      <note><para>
        In the development prototype release, <command>b10-auth</command>
        can serve data from a SQLite3 data source backend and from master
        files.
        Upcoming versions will be able to use multiple different
        data sources, such as MySQL and Berkeley DB.
      </para></note>

      <para>
        The configuration is located in data_sources/classes. Each item there
        represents one RR class and a list used to answer queries for that
        class. The default contains two classes. The CH class contains a static
        data source &mdash; one that serves things like
        <quote>AUTHORS.BIND.</quote>. The IN class contains single SQLite3
        data source with database file located at
        <filename>/usr/local/var/bind10-devel/zone.sqlite3</filename>.
      </para>

      <para>
        Each data source has several options. The first one is
        <varname>type</varname>, which specifies the type of data source to
        use. Valid types include the ones listed below, but bind10 uses
        dynamically loaded modules for them, so there may be more in your
        case. This option is mandatory.
      </para>

      <para>
        Another option is <varname>params</varname>. This option is type
        specific; it holds different data depending on the type
        above. Also, depending on the type, it could be possible to omit it.
      </para>

      <para>
        There are two options related to the so-called cache. If you enable
        cache, zone data from the data source are loaded into memory.
        Then, when answering a query, <command>b10-auth</command> looks
        into the memory only instead of the data source, which speeds
        answering up. The first option is <varname>cache-enable</varname>,
        a boolean value turning the cache on and off (off is the default).
        The second one, <varname>cache-zones</varname>, is a list of zone
        origins to load into in-memory. Remember that zones in the data source
        not listed here will not be loaded and will not be available at all.
      </para>

      <section id='datasource-types'>
        <title>Data source types</title>
        <para>
          As mentioned, the type used by default is <quote>sqlite3</quote>.
          It has single configuration option inside <varname>params</varname>
          &mdash; <varname>database_file</varname>, which contains the path
          to the sqlite3 file containing the data.
        </para>

        <para>
          Another type is called <quote>MasterFiles</quote>. This one is
          slightly special. The data are stored in RFC1034 master files.
          Because answering directly from them would be impractical,
          this type mandates the cache to be enabled. Also, the list of
          zones (<varname>cache-zones</varname>) should be omitted. The
          <varname>params</varname> is a dictionary mapping from zone
          origins to the files they reside in.
        </para>
      </section>

      <section id='datasrc-examples'>
        <title>Examples</title>
        <para>
          As this is one of the more complex configurations of Bind10,
          we show some examples. They all assume they start with default
          configuration.
        </para>

        <para>
          First, let's disable the static data source
          (<quote>VERSION.BIND</quote> and friends). As it is the only
          data source in the CH class, we can remove the whole class.

          <screen>&gt; <userinput>config remove data_sources/classes CH</userinput>
&gt; <userinput>config commit</userinput></screen>
        </para>

        <para>
          Another one, let's say our default data source contains zones
          <quote>example.org.</quote> and <quote>example.net.</quote>.
          We want them to be served from memory to make the answering
          faster.

          <screen>&gt; <userinput>config set data_sources/classes/IN[0]/cache-enable true</userinput>
&gt; <userinput>config add data_sources/classes/IN[0]/cache-zones example.org.</userinput>
&gt; <userinput>config add data_sources/classes/IN[0]/cache-zones example.net.</userinput>
&gt; <userinput>config commit</userinput></screen>

          Now every time the zone in the data source is changed by the
          operator, Bind10 needs to be told to reload it, by
          <screen>&gt; <userinput>Auth loadzone example.org</userinput></screen>
          You don't need to do this when the zone is modified by
          XfrIn, it does so automatically.
        </para>

        <para>
          Now, the last example is when there are master files we want to
          serve in addition to whatever is inside the sqlite3 database.

          <screen>&gt; <userinput>config add data_sources/classes/IN</userinput>
&gt; <userinput>config set data_sources/classes/IN[1]/type MasterFiles</userinput>
&gt; <userinput>config set data_sources/classes/IN[1]/cache-enable true</userinput>
&gt; <userinput>config set data_sources/classes/IN[1]/params { "example.org": "/path/to/example.org", "example.com": "/path/to/example.com" }</userinput>
&gt; <userinput>config commit</userinput></screen>

          Unfortunately, due to current technical limitations, the params must
          be set as one JSON blob, it can't be edited in
          <command>bindctl</command>. To reload a zone, you the same command
          as above.
        </para>
      </section>

      <note>
      <para>
        There's also <varname>Auth/database_file</varname> configuration
        variable, pointing to a sqlite3 database file. This is no longer
        used by <command>b10-auth</command>, but it is left in place for
        now, since other modules use it. Once <command>b10-xfrin</command>,
        <command>b10-xfrout</command> and <command>b10-ddns</command>
        are ported to the new configuration, this will disappear. But for
        now, make sure that if you use any of these modules, the new
        and old configuration correspond. The defaults are consistent, so
        unless you tweaked either the new or the old configuration, you're
        good.
      </para>
      </note>

    </section>

    <section>
      <title>Loading Master Zones Files</title>

      <para>
        RFC 1035 style DNS master zone files may imported
        into a BIND 10 SQLite3 data source by using the
        <command>b10-loadzone</command> utility.
      </para>

      <para>
        <command>b10-loadzone</command> supports the following
        special directives (control entries):

        <variablelist>

          <varlistentry>
            <term>$INCLUDE</term>
            <listitem>
              <simpara>Loads an additional zone file. This may be recursive.
              </simpara>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>$ORIGIN</term>
            <listitem>
              <simpara>Defines the relative domain name.
              </simpara>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term>$TTL</term>
            <listitem>
              <simpara>Defines the time-to-live value used for following
                records that don't include a TTL.
              </simpara>
            </listitem>
          </varlistentry>

        </variablelist>

      </para>

      <para>
        The <option>-o</option> argument may be used to define the
        default origin for loaded zone file records.
      </para>

      <note>
      <para>
        In the development prototype release, only the SQLite3 back
        end is used by <command>b10-loadzone</command>.
        By default, it stores the zone data in
        <filename>/usr/local/var/bind10-devel/zone.sqlite3</filename>
        unless the <option>-d</option> switch is used to set the
        database filename.
        Multiple zones are stored in a single SQLite3 zone database.
      </para>
      </note>

      <para>
        If you reload a zone already existing in the database,
        all records from that prior zone disappear and a whole new set
        appears.
      </para>

<!--TODO: permissions for xfrin or loadzone to create the file -->

    </section>

<!--
TODO
    <section>
      <title>Troubleshooting</title>
      <para>
      </para>
    </section>
-->

  </chapter>

  <chapter id="xfrin">
    <title>Incoming Zone Transfers</title>

    <para>
      Incoming zones are transferred using the <command>b10-xfrin</command>
      process which is started by <command>bind10</command>.
      When received, the zone is stored in the corresponding BIND 10
      data source, and its records can be served by
      <command>b10-auth</command>.
      In combination with <command>b10-zonemgr</command> (for
      automated SOA checks), this allows the BIND 10 server to
      provide <emphasis>secondary</emphasis> service.
    </para>

    <para>
      The <command>b10-xfrin</command> process supports both AXFR and
      IXFR.  Due to some implementation limitations of the current
      development release, however, it only tries AXFR by default,
      and care should be taken to enable IXFR.
    </para>
<!-- TODO: http://bind10.isc.org/ticket/1279 -->

    <section>
      <title>Configuration for Incoming Zone Transfers</title>
      <para>
        In practice, you need to specify a list of secondary zones to
        enable incoming zone transfers for these zones (you can still
        trigger a zone transfer manually, without a prior configuration
        (see below)).
      </para>

      <para>
        For example, to enable zone transfers for a zone named "example.com"
        (whose master address is assumed to be 2001:db8::53 here),
        run the following at the <command>bindctl</command> prompt:

      <screen>&gt; <userinput>config add Xfrin/zones</userinput>
&gt; <userinput>config set Xfrin/zones[0]/name "<option>example.com</option>"</userinput>
&gt; <userinput>config set Xfrin/zones[0]/master_addr "<option>2001:db8::53</option>"</userinput>
&gt; <userinput>config commit</userinput></screen>

      (We assume there has been no zone configuration before).
      </para>
    </section>

    <section>
      <title>Enabling IXFR</title>
      <para>
        As noted above, <command>b10-xfrin</command> uses AXFR for
        zone transfers by default.  To enable IXFR for zone transfers
        for a particular zone, set the <userinput>use_ixfr</userinput>
        configuration parameter to <userinput>true</userinput>.
        In the above example of configuration sequence, you'll need
        to add the following before performing <userinput>commit</userinput>:
      <screen>&gt; <userinput>config set Xfrin/zones[0]/use_ixfr true</userinput></screen>
      </para>

<!-- TODO: http://bind10.isc.org/ticket/1279 -->
      <note><simpara>
      One reason why IXFR is disabled by default in the current
      release is because it does not support automatic fallback from IXFR to
      AXFR when it encounters a primary server that doesn't support
      outbound IXFR (and, not many existing implementations support
      it).  Another, related reason is that it does not use AXFR even
      if it has no knowledge about the zone (like at the very first
      time the secondary server is set up).  IXFR requires the
      "current version" of the zone, so obviously it doesn't work
      in this situation and AXFR is the only workable choice.
      The current release of <command>b10-xfrin</command> does not
      make this selection automatically.
      These features will be implemented in a near future
      version, at which point we will enable IXFR by default.
      </simpara></note>
    </section>

<!-- TODO:

how to tell bind10 you are a secondary?

when will it first attempt to check for new zone? (using REFRESH?)
what if zonemgr is not running?

what if a NOTIFY is sent?

-->

    <section id="zonemgr">
      <title>Secondary Manager</title>

      <para>
        The <command>b10-zonemgr</command> process is started by
        <command>bind10</command>.
        It keeps track of SOA refresh, retry, and expire timers
        and other details for BIND 10 to perform as a slave.
        When the <command>b10-auth</command> authoritative DNS server
        receives a NOTIFY message, <command>b10-zonemgr</command>
        may tell <command>b10-xfrin</command> to do a refresh
        to start an inbound zone transfer.
        The secondary manager resets its counters when a new zone is
        transferred in.
      </para>

      <note><simpara>
        Access control (such as allowing notifies) is not yet provided.
        The primary/secondary service is not yet complete.
      </simpara></note>

      <para>
        The following example shows using <command>bindctl</command>
        to configure the server to be a secondary for the example zone:

      <screen>&gt; <userinput>config add Zonemgr/secondary_zones</userinput>
&gt; <userinput>config set Zonemgr/secondary_zones[0]/name "<option>example.com</option>"</userinput>
&gt; <userinput>config commit</userinput></screen>

      </para>

      <para>
        If the zone does not exist in the data source already
        (i.e. no SOA record for it), <command>b10-zonemgr</command>
        will automatically tell <command>b10-xfrin</command>
        to transfer the zone in.
      </para>

    </section>

    <section>
      <title>Trigger an Incoming Zone Transfer Manually</title>

      <para>
        To manually trigger a zone transfer to retrieve a remote zone,
        you may use the <command>bindctl</command> utility.
        For example, at the <command>bindctl</command> prompt run:

        <screen>&gt; <userinput>Xfrin retransfer zone_name="<option>foo.example.org</option>" master=<option>192.0.2.99</option></userinput></screen>
      </para>
    </section>

    <section>
      <title>Incoming Transfers with In-memory Datasource</title>

      <para>
        In the case of an incoming zone transfer, the received zone is
        first stored in the corresponding BIND 10 datasource. In
        case the secondary zone is served by an in-memory datasource
        with an SQLite3 backend, <command>b10-auth</command> is
        automatically sent a <varname>loadzone</varname> command to
        reload the corresponding zone into memory from the backend.
      </para>
<!-- TODO: currently it delays the queries; see
http://bind10.isc.org/wiki/ScalableZoneLoadDesign#a7.2UpdatingaZone
-->

      <para>
	The administrator doesn't have to do anything for
	<command>b10-auth</command> to serve the new version of the
	zone, except for the configuration such as the one described in
	<xref linkend="datasrc" />.
      </para>
    </section>

<!-- TODO: can that retransfer be used to identify a new zone? -->
<!-- TODO: what if doesn't exist at that master IP? -->

  </chapter>

  <chapter id="xfrout">
    <title>Outbound Zone Transfers</title>
    <para>
      The <command>b10-xfrout</command> process is started by
      <command>bind10</command>.
      When the <command>b10-auth</command> authoritative DNS server
      receives an AXFR or IXFR request, <command>b10-auth</command>
      internally forwards the request to <command>b10-xfrout</command>,
      which handles the rest of this request processing.
      This is used to provide primary DNS service to share zones
      to secondary name servers.
      The <command>b10-xfrout</command> is also used to send
      NOTIFY messages to secondary servers.
    </para>

    <para>
      A global or per zone <option>transfer_acl</option> configuration
      can be used to control accessibility of the outbound zone
      transfer service.
      By default, <command>b10-xfrout</command> allows any clients to
      perform zone transfers for any zones:
    </para>

      <screen>&gt; <userinput>config show Xfrout/transfer_acl</userinput>
Xfrout/transfer_acl[0]	{"action": "ACCEPT"}	any	(default)</screen>

    <para>
      You can change this to, for example, rejecting all transfer
      requests by default while allowing requests for the transfer
      of zone "example.com" from 192.0.2.1 and 2001:db8::1 as follows:
    </para>

      <screen>&gt; <userinput>config set Xfrout/transfer_acl[0] {"action": "REJECT"}</userinput>
&gt; <userinput>config add Xfrout/zone_config</userinput>
&gt; <userinput>config set Xfrout/zone_config[0]/origin "example.com"</userinput>
&gt; <userinput>config set Xfrout/zone_config[0]/transfer_acl [{"action": "ACCEPT", "from": "192.0.2.1"},</userinput>
<userinput>                                                 {"action": "ACCEPT", "from": "2001:db8::1"}]</userinput>
&gt; <userinput>config commit</userinput></screen>

    <note><simpara>
        In the above example the lines
        for <option>transfer_acl</option> were divided for
        readability.  In the actual input it must be in a single line.
    </simpara></note>

    <para>
      If you want to require TSIG in access control, a system wide TSIG
      "key ring" must be configured.
      For example, to change the previous example to allowing requests
      from 192.0.2.1 signed by a TSIG with a key name of
      "key.example", you'll need to do this:
    </para>

    <screen>&gt; <userinput>config set tsig_keys/keys ["key.example:&lt;base64-key&gt;"]</userinput>
&gt; <userinput>config set Xfrout/zone_config[0]/transfer_acl [{"action": "ACCEPT", "from": "192.0.2.1", "key": "key.example"}]</userinput>
&gt; <userinput>config commit</userinput></screen>

    <para>Both <command>b10-xfrout</command> and <command>b10-auth</command>
      will use the system wide keyring to check
      TSIGs in the incoming messages and to sign responses.</para>

    <note><simpara>
        The way to specify zone specific configuration (ACLs, etc) is
        likely to be changed.
    </simpara></note>

<!--
TODO:
xfrout section:
auth servers checks for AXFR query
sends the XFR query to the xfrout module
uses /tmp/auth_xfrout_conn which is a socket
what is XfroutClient xfr_client??
/tmp/auth_xfrout_conn is not removed
-->

  </chapter>

  <chapter id="ddns">
    <title>Dynamic DNS Update</title>

    <para>
      BIND 10 supports the server side of the Dynamic DNS Update
      (DDNS) protocol as defined in RFC 2136.
      This service is provided by the <command>b10-ddns</command>
      component, which is started by the <command>bind10</command>
      process if configured so.
    </para>

    <para>
      When the <command>b10-auth</command> authoritative DNS server
      receives an UPDATE request, it internally forwards the request
      to <command>b10-ddns</command>, which handles the rest of
      this request processing.
      When the processing is completed, <command>b10-ddns</command>
      will send a response to the client as specified in RFC 2136
      (NOERROR for successful update, REFUSED if rejected due to
      ACL check, etc).
      If the zone has been changed as a result, it will internally
      notify <command>b10-xfrout</command> so that other secondary
      servers will be notified via the DNS NOTIFY protocol.
      In addition, if <command>b10-auth</command> serves the updated
      zone (as described in
      <xref linkend="datasrc" />),
      <command>b10-ddns</command> will also
      notify <command>b10-auth</command> so that <command>b10-auth</command>
      will re-cache the updated zone content if necessary.
    </para>

    <para>
      The <command>b10-ddns</command> component supports requests over
      both UDP and TCP, and both IPv6 and IPv4; for TCP requests,
      however, it terminates the TCP connection immediately after
      each single request has been processed.  Clients cannot reuse the
      same TCP connection for multiple requests. (This is a current
      implementation limitation of <command>b10-ddns</command>.
      While RFC 2136 doesn't specify anything about such reuse of TCP
      connection, there is no reason for disallowing it as RFC 1035
      generally allows multiple requests sent over a single TCP
      connection.  BIND 9 supports such reuse.)
    </para>

    <para>
      As of this writing <command>b10-ddns</command> does not support
      update forwarding for secondary zones.
      If it receives an update request for a secondary zone, it will
      immediately return a <quote>not implemented</quote> response.
      <note><simpara>
	  For feature completeness, update forwarding should be
	  eventually supported.  But currently it's considered a lower
	  priority task and there is no specific plan of implementing
	  this feature.
<!-- See Trac #2063 -->
      </simpara></note>
    </para>

    <section>
      <title>Enabling Dynamic Update</title>
      <para>
        First off, it must be made sure that a few components on which
        <command>b10-ddns</command> depends are configured to run,
        which are <command>b10-auth</command>
        and <command>b10-zonemgr</command>.
        In addition, <command>b10-xfrout</command> should also be
        configured to run; otherwise the notification after an update
        (see above) will fail with a timeout, suspending the DDNS
        service while <command>b10-ddns</command> waits for the
        response (see the description of the <ulink
        url="bind10-messages.html#DDNS_UPDATE_NOTIFY_FAIL">DDNS_UPDATE_NOTIFY_FAIL</ulink>
        log message for further details).
        If BIND 10 is already configured to provide authoritative DNS
        service they should normally be configured to run already.
      </para>

      <para>
        Second, for the obvious reason dynamic update requires that the
        underlying data source storing the zone data be writable.
        In the current implementation this means the zone must be stored
        in an SQLite3-based data source.
	Also, in this development version, the <command>b10-ddns</command>
	component configures itself with the data source referring to the
        <varname>database_file</varname> configuration parameter of
        <command>b10-auth</command>.
        So this information must be configured correctly before starting
        <command>b10-ddns</command>.

        <note><simpara>
            The way to configure data sources is now being revised.
            Configuration on the data source for DDNS will be very
            likely to be changed in a backward incompatible manner in
            a near future version.
        </simpara></note>
      </para>

      <para>
	In general, if something goes wrong regarding the dependency
	described above, <command>b10-ddns</command> will log the
	related event at the warning or error level.
	It's advisable to check the log message when you first enable
	DDNS or if it doesn't work as you expect to see if there's any
	warning or error log message.
      </para>

      <para>
        Next, to enable the DDNS service, <command>b10-ddns</command>
        needs to be explicitly configured to run.
        It can be done by using the <command>bindctl</command>
        utility.  For example:
      <screen>
&gt; <userinput>config add Boss/components b10-ddns</userinput>
&gt; <userinput>config set Boss/components/b10-ddns/address DDNS</userinput>
&gt; <userinput>config set Boss/components/b10-ddns/kind dispensable</userinput>
&gt; <userinput>config commit</userinput>
</screen>
      <note><simpara>
	  In theory <varname>kind</varname> could be omitted because
	  "dispensable" is its default.
	  But there's some peculiar behavior (which should be a
	  bug and should be fixed eventually; see Trac ticket #2064)
	  with <command>bindctl</command> and you'll still need to
	  specify that explicitly.  Likewise, <varname>address</varname>
	  may look unnecessary because <command>b10-ddns</command>
	  would start and work without specifying it.  But for it
	  to shutdown gracefully this parameter should also be
	  specified.
      </simpara></note>
      </para>
    </section>

    <section>
      <title>Access Control</title>
      <para>
        By default, <command>b10-ddns</command> rejects any update
        requests from any clients by returning a REFUSED response.
        To allow updates to take effect, an access control rule
        (called update ACL) with a policy allowing updates must explicitly be
        configured.
        Update ACL must be configured per zone basis in the
        <varname>zones</varname> configuration parameter of
        <command>b10-ddns</command>.
        This is a list of per-zone configurations regarding DDNS.
        Each list element consists of the following parameters:
        <variablelist>
          <varlistentry>
            <term>origin</term>
            <listitem>
              <simpara>The zone's origin name</simpara>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>class</term>
            <listitem>
              <simpara>The RR class of the zone
                (normally <quote>IN</quote>, and in that case
		can be omitted in configuration)</simpara>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>update_acl</term>
            <listitem>
              <simpara>List of access control rules (ACL) for the zone</simpara>
            </listitem>
          </varlistentry>
        </variablelist>
        The syntax of the ACL is the same as ACLs for other
        components.
        Specific examples are given below.
      </para>

      <para>
        In general, an update ACL rule that allows an update request
        should be configured with a TSIG key.
        This is an example update ACL that allows updates to the zone
        named <quote>example.org</quote> (of default RR class <quote>IN</quote>)
        from clients that send requests signed with a TSIG whose
        key name is "key.example.org" (and refuses all others):
      <screen>
&gt; <userinput>config add DDNS/zones</userinput>
&gt; <userinput>config set DDNS/zones[0]/origin example.org</userinput>
&gt; <userinput>config add DDNS/zones[0]/update_acl {"action": "ACCEPT", "key": "key.example.org"}</userinput>
&gt; <userinput>config commit</userinput>
</screen>
      The TSIG key must be configured system wide
      (see <xref linkend="xfrout"/>.)
      </para>

      <para>
        Multiple rules can be specified in the ACL, and an ACL rule
        can consist of multiple constraints, such as a combination of
        IP address and TSIG.
        The following configuration sequence will add a new rule to
        the ACL created in the above example.  This additional rule
	allows update requests sent from a client
        using TSIG key name of "key.example" (different from the
        key used in the previous example) and has an IPv6 address of ::1.
      <screen>
&gt; <userinput>config add DDNS/zones[0]/update_acl {"action": "ACCEPT", "from": "::1", "key": "key.example"}</userinput>
&gt; <userinput>config show DDNS/zones[0]/update_acl</userinput>
DDNS/zones[0]/update_acl[0]     {"action": "ACCEPT", "key": "key.example.org"} any (modified)
DDNS/zones[0]/update_acl[1]     {"action": "ACCEPT", "from": "::1", "key": "key.example"} any (modified)
&gt; <userinput>config commit</userinput>
</screen>
      (Note the "add" in the first line.  Before this sequence, we
      have had only entry in <varname>zones[0]/update_acl</varname>.
      The <command>add</command> command with a value (rule) adds
      a new entry and sets it to the given rule.

      Due to a limitation of the current implementation, it doesn't
      work if you first try to just add a new entry and then set it to
      a given rule.)
      </para>

      <note><simpara>
          The <command>b10-ddns</command> component accepts an ACL
          rule that just allows updates from a specific IP address
          (i.e., without requiring TSIG), but this is highly
          discouraged (remember that requests can be made over UDP and
          spoofing the source address of a UDP packet is often pretty
          easy).
          Unless you know what you are doing and that you can accept
          its consequence, any update ACL rule that allows updates
          should have a TSIG key in its constraints.
      </simpara></note>

      <para>
	The ACL rules will be checked in the listed order, and the
	first matching one will apply.
	If none of the rules matches, the default rule will apply,
	which is rejecting any requests in the case of
	<command>b10-ddns</command>.
      </para>
<!-- TODO: what are the other defaults? -->

      <para>
	Other actions than "ACCEPT", namely "REJECT" and "DROP", can be
	used, too.
	See <xref linkend="resolverserver"/> about their effects.
      </para>

      <para>
        Currently update ACL can only control updates per zone basis;
        it's not possible to specify access control with higher
        granularity such as for particular domain names or specific
        types of RRs.
<!-- See Trac ticket #2065 -->
      </para>

      <note><simpara>
        Contrary to what RFC 2136 (literally) specifies,
        <command>b10-ddns</command> checks the update ACL before
        checking the prerequisites of the update request.
        This is a deliberate implementation decision.
        This counter intuitive specification has been repeatedly
        discussed among implementers and in the IETF, and it is now
        widely agreed that it does not make sense to strictly follow
        that part of RFC.
        One known specific bad result of following the RFC is that it
        could leak information about which name or record exists or does not
        exist in the zone as a result of prerequisite checks even if a
        zone is somehow configured to reject normal queries from
        arbitrary clients.
        There have been other troubles that could have been avoided if
        the ACL could be checked before the prerequisite check.
      </simpara></note>
    </section>

    <section>
      <title>Miscellaneous Operational Issues</title>
      <para>
        Unlike BIND 9, BIND 10 currently does not support automatic
        re-signing of DNSSEC-signed zone when it's updated via DDNS.
        It could be possible to re-sign the updated zone afterwards
        or make sure the update request also updates related DNSSEC
        records, but that will be pretty error-prone operation.
        In general, it's not advisable to allow DDNS for a signed zone
        at this moment.
      </para>

      <para>
        Also unlike BIND 9, it's currently not possible
        to <quote>freeze</quote> a zone temporarily in order to
        suspend DDNS while you manually update the zone.
        If you need to make manual updates to a dynamic zone,
        you'll need to temporarily reject any updates to the zone via
        the update ACLs.
      </para>

      <para>
        Dynamic updates are only applicable to primary zones.
        In order to avoid updating secondary zones via DDNS requests,
        <command>b10-ddns</command> refers to the
        <quote>secondary_zones</quote> configuration of
        <command>b10-zonemgr</command>.  Zones listed in
        <quote>secondary_zones</quote> will never be updated via DDNS
        regardless of the update ACL configuration;
	<command>b10-ddns</command> will return a NOTAUTH (server
        not authoritative for the zone) response.
        If you have a "conceptual" secondary zone whose content is a
        copy of some external source but is not updated via the
        standard zone transfers and therefore not listed in
        <quote>secondary_zones</quote>, be careful not to allow DDNS
        for the zone; it would be quite likely to lead to inconsistent
        state between different servers.
        Normally this should not be a problem because the default
        update ACL rejects any update requests, but you may want to
        take an extra care about the configuration if you have such
        type of secondary zones.
      </para>
      <para>
        The difference of two versions of a zone, before and after a
        DDNS transaction, is automatically recorded in the underlying
        data source, and can be retrieved in the form of outbound
        IXFR.
        This is done automatically; it does not require specific
        configuration to make this possible.
      </para>
    </section>
  </chapter>

  <chapter id="resolverserver">
    <title>Recursive Name Server</title>

    <para>
      The <command>b10-resolver</command> process is started by
      <command>bind10</command>.
<!-- TODO
      It provides a resolver so DNS clients can ask it to do recursion
      and it will return answers.
-->
    </para>

    <para>
      The main <command>bind10</command> process can be configured
      to select to run either the authoritative or resolver or both.
      By default, it doesn't start either one. You may change this using
      <command>bindctl</command>, for example:

      <screen>
&gt; <userinput>config add Boss/components b10-resolver</userinput>
&gt; <userinput>config set Boss/components/b10-resolver/special resolver</userinput>
&gt; <userinput>config set Boss/components/b10-resolver/kind needed</userinput>
&gt; <userinput>config set Boss/components/b10-resolver/priority 10</userinput>
&gt; <userinput>config commit</userinput>
</screen>

    </para>

    <para>
       The master <command>bind10</command> will stop and start
       the desired services.
    </para>

    <para>
      By default, the resolver listens on port 53 for 127.0.0.1 and ::1.
      The following example shows how it can be configured to
      listen on an additional address (and port):

      <screen>
&gt; <userinput>config add Resolver/listen_on</userinput>
&gt; <userinput>config set Resolver/listen_on[<replaceable>2</replaceable>]/address "192.168.1.1"</userinput>
&gt; <userinput>config set Resolver/listen_on[<replaceable>2</replaceable>]/port 53</userinput>
&gt; <userinput>config commit</userinput>
</screen>
    </para>

     <simpara>(Replace the <quote><replaceable>2</replaceable></quote>
       as needed; run <quote><userinput>config show
       Resolver/listen_on</userinput></quote> if needed.)</simpara>
<!-- TODO: this example should not include the port, ticket #1185 -->

    <section>
      <title>Access Control</title>

      <para>
        By default, the <command>b10-resolver</command> daemon only accepts
        DNS queries from the localhost (127.0.0.1 and ::1).
        The <option>Resolver/query_acl</option> configuration may
        be used to reject, drop, or allow specific IPs or networks.
        This configuration list is first match.
      </para>

      <para>
        The configuration's <option>action</option> item may be
        set to <quote>ACCEPT</quote> to allow the incoming query,
        <quote>REJECT</quote> to respond with a DNS REFUSED return
        code, or <quote>DROP</quote> to ignore the query without
        any response (such as a blackhole).  For more information,
        see the respective debugging messages:  <ulink
        url="bind10-messages.html#RESOLVER_QUERY_ACCEPTED">RESOLVER_QUERY_ACCEPTED</ulink>,
        <ulink
        url="bind10-messages.html#RESOLVER_QUERY_REJECTED">RESOLVER_QUERY_REJECTED</ulink>,
        and <ulink
url="bind10-messages.html#RESOLVER_QUERY_DROPPED">RESOLVER_QUERY_DROPPED</ulink>.
      </para>

      <para>
        The required configuration's <option>from</option> item is set
        to an IPv4 or IPv6 address, addresses with an network mask, or to
        the special lowercase keywords <quote>any6</quote> (for
        any IPv6 address) or <quote>any4</quote> (for any IPv4
        address).
      </para>

<!-- TODO:
/0 is for any address in that address family
does that need any address too?

TODO: tsig
-->

      <para>
        For example to allow the <replaceable>192.168.1.0/24</replaceable>
        network to use your recursive name server, at the
        <command>bindctl</command> prompt run:
      </para>

      <screen>
&gt; <userinput>config add Resolver/query_acl</userinput>
&gt; <userinput>config set Resolver/query_acl[<replaceable>2</replaceable>]/action "ACCEPT"</userinput>
&gt; <userinput>config set Resolver/query_acl[<replaceable>2</replaceable>]/from "<replaceable>192.168.1.0/24</replaceable>"</userinput>
&gt; <userinput>config commit</userinput>
</screen>

     <simpara>(Replace the <quote><replaceable>2</replaceable></quote>
       as needed; run <quote><userinput>config show
       Resolver/query_acl</userinput></quote> if needed.)</simpara>

<!-- TODO: check this -->
      <note><simpara>This prototype access control configuration
      syntax may be changed.</simpara></note>

    </section>

    <section>
      <title>Forwarding</title>

      <para>

        To enable forwarding, the upstream address and port must be
        configured to forward queries to, such as:

        <screen>
&gt; <userinput>config set Resolver/forward_addresses [{ "address": "<replaceable>192.168.1.1</replaceable>", "port": 53 }]</userinput>
&gt; <userinput>config commit</userinput>
</screen>

        (Replace <replaceable>192.168.1.1</replaceable> to point to your
        full resolver.)
      </para>

      <para>
        Normal iterative name service can be re-enabled by clearing the
        forwarding address(es); for example:

        <screen>
&gt; <userinput>config set Resolver/forward_addresses []</userinput>
&gt; <userinput>config commit</userinput>
</screen>
      </para>

    </section>

<!-- TODO: later try this

> config set Resolver/forward_addresses[0]/address "192.168.8.8"
> config set Resolver/forward_addresses[0]/port 53
then change those defaults with config set Resolver/forward_addresses[0]/address "1.2.3.4"
> config set Resolver/forward_addresses[0]/address "1.2.3.4"
-->

  </chapter>

  <chapter id="dhcp4">
    <title>DHCPv4 Server</title>
    <para>Dynamic Host Configuration Protocol for IPv4 (DHCP or
    DHCPv4) and Dynamic Host Configuration Protocol for IPv6 (DHCPv6)
    are protocols that allow one node (server) to provision
    configuration parameters to many hosts and devices (clients). To
    ease deployment in larger networks, additional nodes (relays) may
    be deployed that facilitate communication between servers and
    clients. Even though principles of both DHCPv4 and DHCPv6 are
    somewhat similar, these are two radically different
    protocols. BIND10 offers server implementations for both DHCPv4
    and DHCPv6. This chapter is about DHCP for IPv4. For a description
    of the DHCPv6 server, see <xref linkend="dhcp6"/>.</para>

    <para>The DHCPv4 server component is currently under intense
    development. You may want to check out <ulink
    url="http://bind10.isc.org/wiki/Kea">BIND10 DHCP (Kea) wiki</ulink>
    and recent posts on <ulink
    url="https://lists.isc.org/mailman/listinfo/bind10-dev">BIND10
    developers mailing list</ulink>.</para>

    <para>The DHCPv4 and DHCPv6 components in BIND10 architecture are
    internally code named <quote>Kea</quote>.</para>

    <note>
      <para>
        As of December 2011, both DHCPv4 and DHCPv6 components are
        skeleton servers. That means that while they are capable of
        performing DHCP configuration, they are not fully functional
        yet. In particular, neither has functional lease
        databases. This means that they will assign the same, fixed,
        hardcoded addresses to any client that will ask. See <xref
        linkend="dhcp4-limit"/> and <xref linkend="dhcp6-limit"/> for
        detailed description.
      </para>
    </note>

    <section id="dhcp4-usage">
      <title>DHCPv4 Server Usage</title>
      <para>BIND10 provides the DHCPv4 server component since December
      2011. It is a skeleton server and can be described as an early
      prototype that is not fully functional yet. It is mature enough
      to conduct first tests in lab environment, but it has
      significant limitations. See <xref linkend="dhcp4-limit"/> for
      details.
      </para>

      <para>
        <command>b10-dhcp4</command> is a BIND10 component and is being
        run under BIND10 framework. To add a DHCPv4 process to the set of running
        BIND10 services, you can use following commands in <command>bindctl</command>:
        <screen>&gt; <userinput>config add Boss/components b10-dhcp4</userinput>
&gt; <userinput>config set Boss/components/b10-dhcp4/kind dispensable</userinput>
&gt; <userinput>config commit</userinput></screen></para>

       <para>
         To shutdown running <command>b10-dhcp4</command>, please use the
         following command:
         <screen>&gt; <userinput>Dhcp4 shutdown</userinput></screen>
         or
         <screen>&gt; <userinput>config remove Boss/components b10-dhcp4</userinput>
&gt; <userinput>config commit</userinput></screen></para>

      <para>
        At start, the server will detect available network interfaces
        and will attempt to open UDP sockets on all interfaces that
        are up, running, are not loopback, and have IPv4 address
        assigned.

        The server will then listen to incoming traffic. Currently
        supported client messages are DISCOVER and REQUEST. The server
        will respond to them with OFFER and ACK, respectively.

        Since the DHCPv4 server opens privileged ports, it requires root
        access. Make sure you run this daemon as root.</para>

        <note>
          <para>
            Integration with <command>bind10</command> is
            planned. Ultimately, <command>b10-dhcp4</command> will not
            be started directly, but rather via
            <command>bind10</command>. Please be aware of this planned
            change.
          </para>
        </note>

    </section>

    <section id="dhcp4-config">
      <title>DHCPv4 Server Configuration</title>
      <para>
        The DHCPv4 server does not have a lease database implemented yet
        nor any support for configuration, so every time the same set
        of configuration options (including the same fixed address)
        will be assigned every time.
      </para>
      <para>
        At this stage of development, the only way to alter the server
        configuration is to tweak its source code. To do so, please
        edit src/bin/dhcp4/dhcp4_srv.cc file and modify following
        parameters and recompile:
        <screen>
const std::string HARDCODED_LEASE = "192.0.2.222"; // assigned lease
const std::string HARDCODED_NETMASK = "255.255.255.0";
const uint32_t    HARDCODED_LEASE_TIME = 60; // in seconds
const std::string HARDCODED_GATEWAY = "192.0.2.1";
const std::string HARDCODED_DNS_SERVER = "192.0.2.2";
const std::string HARDCODED_DOMAIN_NAME = "isc.example.com";
const std::string HARDCODED_SERVER_ID = "192.0.2.1";</screen>

        Lease database and configuration support is planned for 2012.
      </para>
    </section>

    <section id="dhcp4-std">
      <title>Supported standards</title>
      <para>The following standards and draft standards are currently
      supported:</para>
      <itemizedlist>
          <listitem>
            <simpara>RFC2131: Supported messages are DISCOVER, OFFER,
            REQUEST, and ACK.</simpara>
          </listitem>
          <listitem>
            <simpara>RFC2132: Supported options are: PAD (0),
            END(255), Message Type(53), DHCP Server Identifier (54),
            Domain Name (15), DNS Servers (6), IP Address Lease Time
            (51), Subnet mask (1), and Routers (3).</simpara>
          </listitem>
      </itemizedlist>
    </section>

    <section id="dhcp4-limit">
      <title>DHCPv4 Server Limitations</title>
      <para>These are the current limitations of the DHCPv4 server
      software. Most of them are reflections of the early stage of
      development and should be treated as <quote>not implemented
      yet</quote>, rather than actual limitations.</para>
      <itemizedlist>
          <listitem>
            <simpara>During initial IPv4 node configuration, the
            server is expected to send packets to a node that does not
            have IPv4 address assigned yet. The server requires
            certain tricks (or hacks) to transmit such packets. This
            is not implemented yet, therefore DHCPv4 server supports
            relayed traffic only (that is, normal point to point
            communication).</simpara>
          </listitem>
          <listitem>
            <simpara><command>b10-dhcp4</command> provides a single,
            fixed, hardcoded lease to any client that asks.  There is
            no lease manager implemented. If two clients request
            addresses, they will both get the same fixed
            address.</simpara>
          </listitem>
          <listitem>
            <simpara><command>b10-dhcp4</command> does not support any
            configuration mechanisms yet. The whole configuration is
            currently hardcoded. The only way to tweak configuration
            is to directly modify source code. See see <xref
            linkend="dhcp4-config"/> for details.</simpara>
          </listitem>
          <listitem>
            <simpara>Upon start, the server will open sockets on all
            interfaces that are not loopback, are up and running and
            have IPv4 address.</simpara>
          </listitem>
          <listitem>
            <simpara>PRL (Parameter Request List, a list of options
            requested by a client) is currently ignored and server
            assigns DNS SERVER and DOMAIN NAME options.</simpara>
          </listitem>
          <listitem>
            <simpara><command>b10-dhcp4</command> does not support
            BOOTP. That is a design choice. This limitation is
            permanent. If you have legacy nodes that can't use DHCP and
            require BOOTP support, please use latest version of ISC DHCP
            <ulink url="http://www.isc.org/software/dhcp"/>.</simpara>
          </listitem>
          <listitem>
            <simpara>Interface detection is currently working on Linux
            only. See <xref linkend="iface-detect"/> for details.</simpara>
          </listitem>
          <listitem>
            <simpara><command>b10-dhcp4</command> does not verify that
            assigned address is unused. According to RFC2131, the
            allocating server should verify that address is no used by
            sending ICMP echo request.</simpara>
          </listitem>
          <listitem>
            <simpara>Address renewal (RENEW), rebinding (REBIND),
            confirmation (CONFIRM), duplication report (DECLINE) and
            release (RELEASE) are not supported yet.</simpara>
          </listitem>
          <listitem>
            <simpara>DNS Update is not supported yet.</simpara>
          </listitem>
          <listitem>
            <simpara>-v (verbose) command line option is currently
            the default, and cannot be disabled.</simpara>
          </listitem>
      </itemizedlist>
    </section>

  </chapter>

  <chapter id="dhcp6">
    <title>DHCPv6 Server</title>
    <para>Dynamic Host Configuration Protocol for IPv6 (DHCPv6) is
    specified in RFC3315. BIND10 provides DHCPv6 server implementation
    that is described in this chapter. For a description of the DHCPv4
    server implementation, see <xref linkend="dhcp4"/>.
    </para>

    <para>The DHCPv6 server component is currently under intense
    development. You may want to check out <ulink
    url="http://bind10.isc.org/wiki/Kea">BIND10 DHCP (Kea) wiki</ulink>
    and recent posts on <ulink
    url="https://lists.isc.org/mailman/listinfo/bind10-dev">BIND10
    developers mailing list</ulink>.</para>

    <para>The DHCPv4 and DHCPv6 components in BIND10 architecture are
    internally code named <quote>Kea</quote>.</para>

    <note>
      <para>
        As of December 2011, both DHCPv4 and DHCPv6 components are
        skeleton servers. That means that while they are capable of
        performing DHCP configuration, they are not fully functional
        yet. In particular, neither has functional lease
        databases. This means that they will assign the same, fixed,
        hardcoded addresses to any client that will ask. See <xref
        linkend="dhcp4-limit"/> and <xref linkend="dhcp6-limit"/> for
        detailed description.
      </para>
    </note>

    <section id="dhcp6-usage">
      <title>DHCPv6 Server Usage</title>
      <para>
        BIND10 provides the DHCPv6 server component since September
        2011. It is a skeleton server and can be described as an early
        prototype that is not fully functional yet. It is mature
        enough to conduct first tests in lab environment, but it has
        significant limitations. See <xref linkend="dhcp6-limit"/> for
        details.
      </para>

      <para>
        The DHCPv6 server is implemented as <command>b10-dhcp6</command>
        daemon. As it is not configurable yet, it is fully autonomous,
        that is it does not interact with <command>b10-cfgmgr</command>.
        To start DHCPv6 server, simply input:

        <screen>
#<userinput>cd src/bin/dhcp6</userinput>
#<userinput>./b10-dhcp6</userinput>
</screen>

        Depending on your installation, <command>b10-dhcp6</command>
        binary may reside in src/bin/dhcp6 in your source code
        directory, in /usr/local/bin/b10-dhcp6 or other directory
        you specified during compilation.

        At start, server will detect available network interfaces
        and will attempt to open UDP sockets on all interfaces that
        are up, running, are not loopback, are multicast-capable, and
        have IPv6 address assigned.

        The server will then listen to incoming traffic. Currently
        supported client messages are SOLICIT and REQUEST. The server
        will respond to them with ADVERTISE and REPLY, respectively.

        Since the DHCPv6 server opens privileged ports, it requires root
        access. Make sure you run this daemon as root.
      </para>

        <note>
          <para>
            Integration with <command>bind10</command> is
            planned. Ultimately, <command>b10-dhcp6</command> will not
            be started directly, but rather via
            <command>bind10</command>. Please be aware of this planned
            change.
          </para>
        </note>

    </section>

    <section id="dhcp6-config">
      <title>DHCPv6 Server Configuration</title>
      <para>
        The DHCPv6 server does not have lease database implemented yet
        or any support for configuration, so every time the same set
        of configuration options (including the same fixed address)
        will be assigned every time.
      </para>
      <para>
        At this stage of development, the only way to alter server
        configuration is to tweak its source code. To do so, please
        edit src/bin/dhcp6/dhcp6_srv.cc file and modify following
        parameters and recompile:
        <screen>
const std::string HARDCODED_LEASE = "2001:db8:1::1234:abcd";
const uint32_t HARDCODED_T1 = 1500; // in seconds
const uint32_t HARDCODED_T2 = 2600; // in seconds
const uint32_t HARDCODED_PREFERRED_LIFETIME = 3600; // in seconds
const uint32_t HARDCODED_VALID_LIFETIME = 7200; // in seconds
const std::string HARDCODED_DNS_SERVER = "2001:db8:1::1";</screen>

        Lease database and configuration support is planned for 2012.
      </para>

    </section>

    <section id="dhcp6-std">
      <title>Supported DHCPv6 Standards</title>
      <para>The following standards and draft standards are currently
      supported:</para>
      <itemizedlist>
          <listitem>
            <simpara>RFC3315: Supported messages are SOLICIT,
            ADVERTISE, REQUEST, and REPLY. Supported options are
            SERVER_ID, CLIENT_ID, IA_NA, and IAADDRESS.</simpara>
          </listitem>
          <listitem>
            <simpara>RFC3646: Supported option is DNS_SERVERS.</simpara>
          </listitem>
      </itemizedlist>
    </section>

    <section id="dhcp6-limit">
      <title>DHCPv6 Server Limitations</title>
      <para> These are the current limitations of the DHCPv6 server
      software. Most of them are reflections of the early stage of
      development and should be treated as <quote>not implemented
      yet</quote>, rather than actual limitations.</para>
      <para>
      <itemizedlist>
        <listitem>
          <simpara>Relayed traffic is not supported.</simpara>
        </listitem>
        <listitem>
          <simpara><command>b10-dhcp6</command> provides a single,
          fixed, hardcoded lease to any client that asks. There is no
          lease manager implemented. If two clients request addresses,
          they will both get the same fixed address.</simpara>
        </listitem>
        <listitem>
          <simpara><command>b10-dhcp6</command> does not support any
            configuration mechanisms yet. The whole configuration is
            currently hardcoded. The only way to tweak configuration
            is to directly modify source code. See see <xref
            linkend="dhcp6-config"/> for details.</simpara>
        </listitem>
        <listitem>
          <simpara>Upon start, the server will open sockets on all
          interfaces that are not loopback, are up, running and are
          multicast capable and have IPv6 address.  Support for
          multiple interfaces is not coded in reception routines yet,
          so if you are running this code on a machine that has many
          interfaces and <command>b10-dhcp6</command> happens to
          listen on wrong interface, the easiest way to work around
          this problem is to turn down other interfaces. This
          limitation will be fixed shortly.</simpara>
        </listitem>
        <listitem>
          <simpara>ORO (Option Request Option, a list of options
          requested by a client) is currently ignored and server
          assigns DNS SERVER option.</simpara>
        </listitem>
        <listitem>
          <simpara>Temporary addresses are not supported yet.</simpara>
        </listitem>
        <listitem>
          <simpara>Prefix delegation is not supported yet.</simpara>
        </listitem>
        <listitem>
          <simpara>Address renewal (RENEW), rebinding (REBIND),
          confirmation (CONFIRM), duplication report (DECLINE) and
          release (RELEASE) are not supported yet.</simpara>
        </listitem>
        <listitem>
          <simpara>DNS Update is not supported yet.</simpara>
        </listitem>
        <listitem>
          <simpara>Interface detection is currently working on Linux
          only. See <xref linkend="iface-detect"/> for details.</simpara>
        </listitem>
        <listitem>
          <simpara>-v (verbose) command line option is currently the
          default, and cannot be disabled.</simpara>
        </listitem>
      </itemizedlist>
      </para>
    </section>

  </chapter>

  <chapter id="libdhcp">
    <title>libdhcp++ library</title>
    <para>libdhcp++ is a common library written in C++ that handles
    many DHCP-related tasks, like DHCPv4 and DHCPv6 packets parsing,
    manipulation and assembly, option parsing, manipulation and
    assembly, network interface detection and socket operations, like
    socket creations, data transmission and reception and socket
    closing.
    </para>

    <para>
    While this library is currently used by
    <command>b10-dhcp4</command> and <command>b10-dhcp6</command>
    only, it is designed to be portable, universal library useful for
    any kind of DHCP-related software.
    </para>

    <section id="iface-detect">
      <title>Interface detection</title>
      <para>Both DHCPv4 and DHCPv6 components share network
      interface detection routines. Interface detection is
      currently only supported on Linux systems.</para>

      <para>For non-Linux systems, there is currently stub
      implementation provided. Interface manager detects loopback
      interfaces only as their name (lo or lo0) can be easily predicted.
      Please contact BIND10 development team if you are interested
      in running DHCP components on systems other than Linux.</para>
    </section>

    <section id="packet-handling">
      <title>DHCPv4/DHCPv6 packet handling</title>
      <para>TODO: Describe packet handling here, with pointers to wiki</para>
    </section>

  </chapter>

  <chapter id="statistics">
    <title>Statistics</title>

    <para>
      The <command>b10-stats</command> process is started by
      <command>bind10</command>.
      It periodically collects statistics data from various modules
      and aggregates it.
<!-- TODO -->
    </para>

    <para>

       This stats daemon provides commands to identify if it is
       running, show specified or all statistics data, and show specified
       or all statistics data schema.

       For example, using <command>bindctl</command>:

       <screen>
&gt; <userinput>Stats show</userinput>
{
    "Auth": {
        "opcode.iquery": 0,
        "opcode.notify": 10,
        "opcode.query": 869617,
        ...
        "queries.tcp": 1749,
        "queries.udp": 867868
    },
    "Boss": {
        "boot_time": "2011-01-20T16:59:03Z"
    },
    "Stats": {
        "boot_time": "2011-01-20T16:59:05Z",
        "last_update_time": "2011-01-20T17:04:05Z",
        "lname": "4d3869d9_a@jreed.example.net",
        "report_time": "2011-01-20T17:04:06Z",
        "timestamp": 1295543046.823504
    }
}
       </screen>
    </para>

  </chapter>

  <chapter id="logging">
    <title>Logging</title>

    <section>
      <title>Logging configuration</title>

      <para>

        The logging system in BIND 10 is configured through the
        Logging module. All BIND 10 modules will look at the
        configuration in Logging to see what should be logged and
        to where.

<!-- TODO: what is context of Logging module for readers of this guide? -->

      </para>

      <section>
        <title>Loggers</title>

        <para>

          Within BIND 10, a message is logged through a component
          called a "logger". Different parts of BIND 10 log messages
          through different loggers, and each logger can be configured
          independently of one another.

        </para>

        <para>

          In the Logging module, you can specify the configuration
          for zero or more loggers; any that are not specified will
          take appropriate default values.

        </para>

        <para>

          The three most important elements of a logger configuration
          are the <option>name</option> (the component that is
          generating the messages), the <option>severity</option>
          (what to log), and the <option>output_options</option>
          (where to log).

        </para>

        <section>
          <title>name (string)</title>

          <para>
          Each logger in the system has a name, the name being that
          of the component using it to log messages. For instance,
          if you want to configure logging for the resolver module,
          you add an entry for a logger named <quote>Resolver</quote>. This
          configuration will then be used by the loggers in the
          Resolver module, and all the libraries used by it.
              </para>

<!-- TODO: later we will have a way to know names of all modules

Right now you can only see what their names are if they are running
(a simple 'help' without anything else in bindctl for instance).

 -->

        <para>

          If you want to specify logging for one specific library
          within the module, you set the name to
          <replaceable>module.library</replaceable>.  For example, the
          logger used by the nameserver address store component
          has the full name of <quote>Resolver.nsas</quote>. If
          there is no entry in Logging for a particular library,
          it will use the configuration given for the module.

<!-- TODO: how to know these specific names?

We will either have to document them or tell the administrator to
specify module-wide logging and see what appears...

-->

        </para>

        <para>

<!-- TODO: severity has not been covered yet -->

          To illustrate this, suppose you want the cache library
          to log messages of severity DEBUG, and the rest of the
          resolver code to log messages of severity INFO. To achieve
          this you specify two loggers, one with the name
          <quote>Resolver</quote> and severity INFO, and one with
          the name <quote>Resolver.cache</quote> with severity
          DEBUG. As there are no entries for other libraries (e.g.
          the nsas), they will use the configuration for the module
          (<quote>Resolver</quote>), so giving the desired behavior.

        </para>

        <para>

          One special case is that of a module name of <quote>*</quote>
          (asterisks), which is interpreted as <emphasis>any</emphasis>
          module. You can set global logging options by using this,
          including setting the logging configuration for a library
          that is used by multiple modules (e.g. <quote>*.config</quote>
          specifies the configuration library code in whatever
          module is using it).

        </para>

        <para>

          If there are multiple logger specifications in the
          configuration that might match a particular logger, the
          specification with the more specific logger name takes
          precedence. For example, if there are entries for for
          both <quote>*</quote> and <quote>Resolver</quote>, the
          resolver module &mdash; and all libraries it uses &mdash;
          will log messages according to the configuration in the
          second entry (<quote>Resolver</quote>). All other modules
          will use the configuration of the first entry
          (<quote>*</quote>). If there was also a configuration
          entry for <quote>Resolver.cache</quote>, the cache library
          within the resolver would use that in preference to the
          entry for <quote>Resolver</quote>.

        </para>

        <para>

          One final note about the naming. When specifying the
          module name within a logger, use the name of the module
          as specified in <command>bindctl</command>, e.g.
          <quote>Resolver</quote> for the resolver module,
          <quote>Xfrout</quote> for the xfrout module, etc. When
          the message is logged, the message will include the name
          of the logger generating the message, but with the module
          name replaced by the name of the process implementing
          the module (so for example, a message generated by the
          <quote>Auth.cache</quote> logger will appear in the output
          with a logger name of <quote>b10-auth.cache</quote>).

        </para>

        </section>

        <section>
          <title>severity (string)</title>

        <para>

          This specifies the category of messages logged.
          Each message is logged with an associated severity which
          may be one of the following (in descending order of
          severity):
        </para>

        <itemizedlist>
          <listitem>
            <simpara> FATAL </simpara>
          </listitem>

          <listitem>
            <simpara> ERROR </simpara>
          </listitem>

          <listitem>
            <simpara> WARN </simpara>
          </listitem>

          <listitem>
            <simpara> INFO </simpara>
          </listitem>

          <listitem>
            <simpara> DEBUG </simpara>
          </listitem>
        </itemizedlist>

        <para>

          When the severity of a logger is set to one of these
          values, it will only log messages of that severity, and
          the severities above it. The severity may also be set to
          NONE, in which case all messages from that logger are
          inhibited.

<!-- TODO: worded wrong? If I set to INFO, why would it show DEBUG which is literally below in that list? -->

        </para>

        </section>

        <section>
          <title>output_options (list)</title>

        <para>

          Each logger can have zero or more
          <option>output_options</option>. These specify where log
          messages are sent to. These are explained in detail below.

        </para>

        <para>

          The other options for a logger are:

        </para>

        </section>

        <section>
          <title>debuglevel (integer)</title>

        <para>

          When a logger's severity is set to DEBUG, this value
          specifies what debug messages should be printed. It ranges
          from 0 (least verbose) to 99 (most verbose).
        </para>


<!-- TODO: complete this sentence:

          The general classification of debug message types is

TODO; there's a ticket to determine these levels, see #1074

 -->

        <para>

          If severity for the logger is not DEBUG, this value is ignored.

        </para>

        </section>

        <section>
          <title>additive (true or false)</title>

        <para>

          If this is true, the <option>output_options</option> from
          the parent will be used. For example, if there are two
          loggers configured; <quote>Resolver</quote> and
          <quote>Resolver.cache</quote>, and <option>additive</option>
          is true in the second, it will write the log messages
          not only to the destinations specified for
          <quote>Resolver.cache</quote>, but also to the destinations
          as specified in the <option>output_options</option> in
          the logger named <quote>Resolver</quote>.

<!-- TODO: check this -->

      </para>

      </section>

      </section>

      <section>
        <title>Output Options</title>

        <para>

          The main settings for an output option are the
          <option>destination</option> and a value called
          <option>output</option>, the meaning of which depends on
          the destination that is set.

        </para>

        <section>
          <title>destination (string)</title>

          <para>

            The destination is the type of output. It can be one of:

          </para>

          <itemizedlist>

            <listitem>
              <simpara> console </simpara>
          </listitem>

            <listitem>
              <simpara> file </simpara>
          </listitem>

            <listitem>
              <simpara> syslog </simpara>
            </listitem>

          </itemizedlist>

        </section>

        <section>
          <title>output (string)</title>

        <para>

          Depending on what is set as the output destination, this
          value is interpreted as follows:

        </para>

        <variablelist>

          <varlistentry>
            <term><option>destination</option> is <quote>console</quote></term>
            <listitem>
              <para>
                 The value of output must be one of <quote>stdout</quote>
                 (messages printed to standard output) or
                 <quote>stderr</quote> (messages printed to standard
                 error).
              </para>
              <para>
                Note: if output is set to <quote>stderr</quote> and a lot of
                messages are produced in a short time (e.g. if the logging
                level is set to DEBUG), you may occasionally see some messages
                jumbled up together.  This is due to a combination of the way
                that messages are written to the screen and the unbuffered
                nature of the standard error stream.  If this occurs, it is
                recommended that output be set to <quote>stdout</quote>.
              </para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><option>destination</option> is <quote>file</quote></term>
            <listitem>
              <para>
                The value of output is interpreted as a file name;
                log messages will be appended to this file.
              </para>
            </listitem>
          </varlistentry>

          <varlistentry>
            <term><option>destination</option> is <quote>syslog</quote></term>
            <listitem>
              <para>
                The value of output is interpreted as the
                <command>syslog</command> facility (e.g.
                <emphasis>local0</emphasis>) that should be used
                for log messages.
              </para>
            </listitem>
          </varlistentry>

        </variablelist>

        <para>

          The other options for <option>output_options</option> are:

        </para>

        <section>
          <title>flush (true of false)</title>

          <para>
            Flush buffers after each log message. Doing this will
            reduce performance but will ensure that if the program
            terminates abnormally, all messages up to the point of
            termination are output.
          </para>

        </section>

        <section>
          <title>maxsize (integer)</title>

          <para>
            Only relevant when destination is file, this is maximum
            file size of output files in bytes. When the maximum
            size is reached, the file is renamed and a new file opened.
            (For example, a ".1" is appended to the name &mdash;
            if a ".1" file exists, it is renamed ".2",
            etc.)
          </para>

          <para>
            If this is 0, no maximum file size is used.
          </para>

        </section>

        <section>
          <title>maxver (integer)</title>

          <para>
            Maximum number of old log files to keep around when
            rolling the output file. Only relevant when
            <option>destination</option> is <quote>file</quote>.
          </para>

        </section>

      </section>

      </section>

      <section>
        <title>Example session</title>

        <para>

          In this example we want to set the global logging to
          write to the file <filename>/var/log/my_bind10.log</filename>,
          at severity WARN. We want the authoritative server to
          log at DEBUG with debuglevel 40, to a different file
          (<filename>/tmp/debug_messages</filename>).

        </para>

        <para>

          Start <command>bindctl</command>.

        </para>

        <para>

           <screen>["login success "]
&gt; <userinput>config show Logging</userinput>
Logging/loggers	[]	list
</screen>

        </para>

        <para>

          By default, no specific loggers are configured, in which
          case the severity defaults to INFO and the output is
          written to stderr.

        </para>

        <para>

          Let's first add a default logger:

        </para>

<!-- TODO: adding the empty loggers makes no sense -->
        <para>

          <screen><userinput>&gt; config add Logging/loggers</userinput>
&gt; <userinput>config show Logging</userinput>
Logging/loggers/	list	(modified)
</screen>

        </para>

        <para>

          The loggers value line changed to indicate that it is no
          longer an empty list:

        </para>

        <para>

          <screen>&gt; <userinput>config show Logging/loggers</userinput>
Logging/loggers[0]/name	""	string	(default)
Logging/loggers[0]/severity	"INFO"	string	(default)
Logging/loggers[0]/debuglevel	0	integer	(default)
Logging/loggers[0]/additive	false	boolean	(default)
Logging/loggers[0]/output_options	[]	list	(default)
</screen>

        </para>

        <para>

          The name is mandatory, so we must set it. We will also
          change the severity as well. Let's start with the global
          logger.

        </para>

        <para>

          <screen>&gt; <userinput>config set Logging/loggers[0]/name *</userinput>
&gt; <userinput>config set Logging/loggers[0]/severity WARN</userinput>
&gt; <userinput>config show Logging/loggers</userinput>
Logging/loggers[0]/name	"*"	string	(modified)
Logging/loggers[0]/severity	"WARN"	string	(modified)
Logging/loggers[0]/debuglevel	0	integer	(default)
Logging/loggers[0]/additive	false	boolean	(default)
Logging/loggers[0]/output_options	[]	list	(default)
</screen>

        </para>

        <para>

          Of course, we need to specify where we want the log
          messages to go, so we add an entry for an output option.

        </para>

        <para>

          <screen>&gt; <userinput> config add Logging/loggers[0]/output_options</userinput>
&gt; <userinput> config show Logging/loggers[0]/output_options</userinput>
Logging/loggers[0]/output_options[0]/destination	"console"	string	(default)
Logging/loggers[0]/output_options[0]/output	"stdout"	string	(default)
Logging/loggers[0]/output_options[0]/flush	false	boolean	(default)
Logging/loggers[0]/output_options[0]/maxsize	0	integer	(default)
Logging/loggers[0]/output_options[0]/maxver	0	integer	(default)
</screen>


        </para>

        <para>

          These aren't the values we are looking for.

        </para>

        <para>

          <screen>&gt; <userinput> config set Logging/loggers[0]/output_options[0]/destination file</userinput>
&gt; <userinput> config set Logging/loggers[0]/output_options[0]/output /var/log/bind10.log</userinput>
&gt; <userinput> config set Logging/loggers[0]/output_options[0]/maxsize 204800</userinput>
&gt; <userinput> config set Logging/loggers[0]/output_options[0]/maxver 8</userinput>
</screen>

        </para>

        <para>

          Which would make the entire configuration for this logger
          look like:

        </para>

        <para>

          <screen>&gt; <userinput> config show all Logging/loggers</userinput>
Logging/loggers[0]/name	"*"	string	(modified)
Logging/loggers[0]/severity	"WARN"	string	(modified)
Logging/loggers[0]/debuglevel	0	integer	(default)
Logging/loggers[0]/additive	false	boolean	(default)
Logging/loggers[0]/output_options[0]/destination	"file"	string	(modified)
Logging/loggers[0]/output_options[0]/output	"/var/log/bind10.log"	string	(modified)
Logging/loggers[0]/output_options[0]/flush	false	boolean	(default)
Logging/loggers[0]/output_options[0]/maxsize	204800	integer	(modified)
Logging/loggers[0]/output_options[0]/maxver	8	integer	(modified)
</screen>

        </para>

        <para>

          That looks OK, so let's commit it before we add the
          configuration for the authoritative server's logger.

        </para>

        <para>

          <screen>&gt; <userinput> config commit</userinput></screen>

        </para>

        <para>

          Now that we have set it, and checked each value along
          the way, adding a second entry is quite similar.

        </para>

        <para>

          <screen>&gt; <userinput> config add Logging/loggers</userinput>
&gt; <userinput> config set Logging/loggers[1]/name Auth</userinput>
&gt; <userinput> config set Logging/loggers[1]/severity DEBUG</userinput>
&gt; <userinput> config set Logging/loggers[1]/debuglevel 40</userinput>
&gt; <userinput> config add Logging/loggers[1]/output_options</userinput>
&gt; <userinput> config set Logging/loggers[1]/output_options[0]/destination file</userinput>
&gt; <userinput> config set Logging/loggers[1]/output_options[0]/output /tmp/auth_debug.log</userinput>
&gt; <userinput> config commit</userinput>
</screen>

        </para>

        <para>

          And that's it. Once we have found whatever it was we
          needed the debug messages for, we can simply remove the
          second logger to let the authoritative server use the
          same settings as the rest.

        </para>

        <para>

          <screen>&gt; <userinput> config remove Logging/loggers[1]</userinput>
&gt; <userinput> config commit</userinput>
</screen>

        </para>

        <para>

          And every module will now be using the values from the
          logger named <quote>*</quote>.

        </para>

      </section>

    </section>

    <section>
      <title>Logging Message Format</title>

      <para>
          Each message written by BIND 10 to the configured logging
          destinations comprises a number of components that identify
          the origin of the message and, if the message indicates
          a problem, information about the problem that may be
          useful in fixing it.
      </para>

      <para>
          Consider the message below logged to a file:
          <screen>2011-06-15 13:48:22.034 ERROR [b10-resolver.asiolink]
    ASIODNS_OPENSOCK error 111 opening TCP socket to 127.0.0.1(53)</screen>
      </para>

      <para>
        Note: the layout of messages written to the system logging
        file (syslog) may be slightly different.  This message has
        been split across two lines here for display reasons; in the
        logging file, it will appear on one line.)
      </para>

      <para>
        The log message comprises a number of components:

          <variablelist>
          <varlistentry>
          <term>2011-06-15 13:48:22.034</term>
<!-- TODO: timestamp repeated even if using syslog? -->
          <listitem><para>
              The date and time at which the message was generated.
          </para></listitem>
          </varlistentry>

          <varlistentry>
          <term>ERROR</term>
          <listitem><para>
              The severity of the message.
          </para></listitem>
          </varlistentry>

          <varlistentry>
          <term>[b10-resolver.asiolink]</term>
          <listitem><para>
            The source of the message.  This comprises two components:
            the BIND 10 process generating the message (in this
            case, <command>b10-resolver</command>) and the module
            within the program from which the message originated
            (which in the example is the asynchronous I/O link
            module, asiolink).
          </para></listitem>
          </varlistentry>

          <varlistentry>
          <term>ASIODNS_OPENSOCK</term>
          <listitem><para>
            The message identification.  Every message in BIND 10
            has a unique identification, which can be used as an
            index into the <ulink
            url="bind10-messages.html"><citetitle>BIND 10 Messages
            Manual</citetitle></ulink> (<ulink
            url="http://bind10.isc.org/docs/bind10-messages.html"
            />) from which more information can be obtained.
          </para></listitem>
          </varlistentry>

          <varlistentry>
          <term>error 111 opening TCP socket to 127.0.0.1(53)</term>
          <listitem><para>
              A brief description of the cause of the problem.
              Within this text, information relating to the condition
              that caused the message to be logged will be included.
              In this example, error number 111 (an operating
              system-specific error number) was encountered when
              trying to open a TCP connection to port 53 on the
              local system (address 127.0.0.1).  The next step
              would be to find out the reason for the failure by
              consulting your system's documentation to identify
              what error number 111 means.
          </para></listitem>
          </varlistentry>
          </variablelist>
      </para>

    </section>

  </chapter>

<!-- TODO: Add bibliography section (mostly RFCs, probably) -->


<!-- TODO: how to help: run unit tests, join lists, review trac tickets -->

  <!-- <index>    <title>Index</title> </index> -->

</book>

<!--

TODO:

Overview

Getting BIND 10 Installed
  Basics
  Dependencies
  Optional
  Advanced

How Does Everything Work Together?

Need Help?

-->
